<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°</title>
    
    <!-- SEO ë©”íƒ€ë°ì´í„° -->
    <meta name="description" content="êµì‚¬ìš© ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ì œì‘ ë° í•™ìƒìš© í’€ì´ ì›¹ì•±. ì—‘ì…€ ì—…ë¡œë“œ, QRì½”ë“œ ê³µìœ , ìë™ ë°°ì¹˜ ê¸°ëŠ¥ ì§€ì›.">
    <meta name="keywords" content="ë‚±ë§í€´ì¦ˆ, ê°€ë¡œì„¸ë¡œí€´ì¦ˆ, êµìœ¡, êµì‚¬, í•™ìƒ, ì›¹ì•±, í€´ì¦ˆì œì‘">
    <meta name="author" content="CrosswordMaker">
    
    <!-- Open Graph (ì†Œì…œ ë¯¸ë””ì–´ ê³µìœ ) -->
    <meta property="og:title" content="ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°">
    <meta property="og:description" content="êµì‚¬ì™€ í•™ìƒì„ ìœ„í•œ ë‚±ë§í€´ì¦ˆ ì œì‘ ë° í’€ì´ ë„êµ¬">
    <meta property="og:type" content="website">
    <meta property="og:image" content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§©</text></svg>">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§©</text></svg>">
    
    <!-- SheetJS for Excel file processing -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    
    <!-- QR ì½”ë“œ ìƒì„±ì„ ìœ„í•œ ê°œì„ ëœ í•¨ìˆ˜ -->
    <script>
        // ğŸš€ ê°œì„ ëœ QR ì½”ë“œ ìƒì„± í•¨ìˆ˜ (ì—¬ëŸ¬ ë°©ë²• ì§€ì›)
        window.generateQRCode = function(text, canvas, options = {}) {
            console.log('ğŸ¯ QR ì½”ë“œ ìƒì„± ì‹œì‘:', text);
            
            const size = options.width || 160;
            const margin = options.margin || 0;
            
            // ë°©ë²• 1: QR Server API ì‹œë„ (ë” ì•ˆì •ì )
            function tryQRServerAPI() {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                // QR Server API - ë” ì•ˆì •ì ì´ê³  ë¹ ë¦„
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}&format=png&margin=${margin}`;
                
                img.onload = function() {
                    try {
                        const ctx = canvas.getContext('2d');
                        canvas.width = size;
                        canvas.height = size;
                        
                        // ë°°ê²½ ìƒ‰ìƒ ì„¤ì •
                        ctx.fillStyle = options.color?.light || '#FFFFFF';
                        ctx.fillRect(0, 0, size, size);
                        
                        // QR ì½”ë“œ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                        ctx.drawImage(img, 0, 0, size, size);
                        
                        console.log('âœ… QR ì½”ë“œ ìƒì„± ì„±ê³µ! (QR Server API)');
                        console.log('ğŸ“± QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ë©´ ìë™ìœ¼ë¡œ í€´ì¦ˆê°€ ë¡œë“œë©ë‹ˆë‹¤');
                        
                        if (options.onSuccess) options.onSuccess();
                    } catch (error) {
                        console.error('âŒ QR Server API ê·¸ë¦¬ê¸° ì˜¤ë¥˜:', error);
                        tryGoogleChartsAPI(); // í´ë°±
                    }
                };
                
                img.onerror = function() {
                    console.warn('âš ï¸ QR Server API ì‹¤íŒ¨, Google Charts API ì‹œë„...');
                    tryGoogleChartsAPI(); // í´ë°±
                };
                
                img.src = qrUrl;
            }
            
            // ë°©ë²• 2: Google Charts API í´ë°±
            function tryGoogleChartsAPI() {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                const qrUrl = `https://chart.googleapis.com/chart?chs=${size}x${size}&cht=qr&chl=${encodeURIComponent(text)}&choe=UTF-8`;
                
                img.onload = function() {
                    try {
                        const ctx = canvas.getContext('2d');
                        canvas.width = size;
                        canvas.height = size;
                        
                        ctx.fillStyle = options.color?.light || '#FFFFFF';
                        ctx.fillRect(0, 0, size, size);
                        ctx.drawImage(img, 0, 0, size, size);
                        
                        console.log('âœ… QR ì½”ë“œ ìƒì„± ì„±ê³µ! (Google Charts API)');
                        if (options.onSuccess) options.onSuccess();
                    } catch (error) {
                        console.error('âŒ Google Charts API ê·¸ë¦¬ê¸° ì˜¤ë¥˜:', error);
                        createFallbackQR(); // ìµœì¢… í´ë°±
                    }
                };
                
                img.onerror = function() {
                    console.warn('âš ï¸ Google Charts APIë„ ì‹¤íŒ¨, ëŒ€ì²´ QR ì½”ë“œ ìƒì„±...');
                    createFallbackQR(); // ìµœì¢… í´ë°±
                };
                
                img.src = qrUrl;
            }
            
            // ë°©ë²• 3: ëŒ€ì²´ QR ì½”ë“œ (ìµœì¢… í´ë°±)
            function createFallbackQR() {
                try {
                    const ctx = canvas.getContext('2d');
                    canvas.width = size;
                    canvas.height = size;
                    
                    // ë°°ê²½
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, size, size);
                    
                    // í…Œë‘ë¦¬
                    ctx.strokeStyle = '#333333';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(8, 8, size-16, size-16);
                    
                    // QR íŒ¨í„´ (ê°„ë‹¨í•œ í”½ì…€ ì•„íŠ¸)
                    ctx.fillStyle = '#333333';
                    const unit = Math.floor((size - 20) / 15);
                    for (let i = 0; i < 15; i++) {
                        for (let j = 0; j < 15; j++) {
                            if ((i + j) % 3 === 0 || (i % 4 === 0 && j % 4 === 0)) {
                                ctx.fillRect(10 + i * unit, 10 + j * unit, unit-1, unit-1);
                            }
                        }
                    }
                    
                    // ì¤‘ì•™ ì•„ì´ì½˜
                    ctx.fillStyle = '#2196F3';
                    ctx.font = `bold ${Math.floor(size/8)}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText('QR', size/2, size/2 + size/32);
                    
                    console.log('âœ… ëŒ€ì²´ QR ì½”ë“œ ìƒì„± ì™„ë£Œ!');
                    console.log('ğŸ’¡ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”');
                    if (options.onSuccess) options.onSuccess();
                } catch (error) {
                    console.error('âŒ ëŒ€ì²´ QR ì½”ë“œ ìƒì„±ë„ ì‹¤íŒ¨:', error);
                    if (options.onError) options.onError(error);
                }
            }
            
            // QR ì½”ë“œ ìƒì„± ì‹œì‘ (ê°€ì¥ ì•ˆì •ì ì¸ ë°©ë²•ë¶€í„°)
            tryQRServerAPI();
        };
        
        console.log('ğŸ“š ê°œì„ ëœ QR ì½”ë“œ ìƒì„± í•¨ìˆ˜ ë¡œë”© ì™„ë£Œ (ë‹¤ì¤‘ API + í´ë°± ì§€ì›)');
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 10px;
            margin: 0;
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            box-sizing: border-box;
        }
        
        html {
            overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            box-sizing: border-box;
        }
        
        .container {
            max-width: 100vw;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: clamp(15px, 4vw, 30px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 5px;
                border-radius: 15px;
                padding: 15px;
            }
        }
        
        .header {
            text-align: center;
            margin-bottom: clamp(20px, 5vw, 30px);
            padding-bottom: clamp(15px, 3vw, 20px);
            border-bottom: 3px solid #667eea;
            background: linear-gradient(135deg, #f8faff 0%, #e8f2ff 100%);
            margin: -30px -30px 30px -30px;
            padding: 30px;
            position: relative;
        }
        
        @media (max-width: 768px) {
            .header {
                margin: -15px -15px 20px -15px;
                padding: 20px 15px;
            }
        }
        
        .header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 15px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .mode-badge {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            display: inline-block;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }
        
        .mode-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }
        
        .mode-badge:active {
            transform: translateY(0);
        }
        
        .mode-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .mode-badge:hover::before {
            left: 100%;
        }
        
        @media (max-width: 768px) {
            .mode-badge {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
        
        .quiz-title {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 18px;
            margin-bottom: 30px;
            transition: border-color 0.3s ease;
        }
        
        .quiz-title:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: clamp(20px, 4vw, 40px);
        }
        
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .main-layout {
                gap: 15px;
            }
        }
        
        .word-panel {
            background: linear-gradient(135deg, #f8faff 0%, #fff 100%);
            padding: clamp(15px, 3vw, 25px);
            border-radius: 20px;
            border: 1px solid rgba(102, 126, 234, 0.15);
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            height: fit-content;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .word-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .word-panel:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .panel-title {
            font-size: clamp(1.2rem, 3vw, 1.4rem);
            color: #2c3e50;
            margin-bottom: clamp(15px, 3vw, 20px);
            margin-top: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.5px;
        }
        
        .panel-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e8eaff;
            border-radius: 12px;
            font-size: clamp(13px, 2.5vw, 14px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #fff 0%, #f8faff 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
            background: #fff;
            transform: translateY(-1px);
        }
        
        .form-input:hover, .form-select:hover {
            border-color: #a8b5ff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: clamp(12px, 2.5vw, 14px);
            letter-spacing: 0.3px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.25);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.35);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.25);
        }
        
        .btn-success:hover {
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.35);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.25);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 30px rgba(108, 117, 125, 0.35);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2196F3, #1976d2);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.25);
        }
        
        .btn-primary:hover {
            box-shadow: 0 10px 30px rgba(33, 150, 243, 0.35);
        }
        
        @media (max-width: 768px) {
            .btn {
                padding: 10px 16px;
                font-size: 12px;
                margin: 3px;
            }
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .grid-panel {
            background: linear-gradient(135deg, #fff 0%, #f8faff 100%);
            padding: clamp(15px, 3vw, 25px);
            border-radius: 20px;
            border: 1px solid rgba(102, 126, 234, 0.15);
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .grid-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #764ba2, #667eea);
        }
        
        .grid-panel:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .grid-controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .grid-size-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e8eaff;
        }
        
        .size-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }
        
        .grid-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .grid {
            display: grid;
            gap: 2px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .cell {
            width: 40px;
            height: 40px;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• - ê·¸ë¦¬ë“œ ìµœì í™” */
        @media (max-width: 768px) {
            .cell {
                width: calc((100vw - 80px) / 10 - 3px);
                height: calc((100vw - 80px) / 10 - 3px);
                min-width: 25px;
                min-height: 25px;
                max-width: 35px;
                max-height: 35px;
                font-size: 12px;
                border-width: 1px;
            }
            
            .grid {
                padding: 10px;
                gap: 1px;
                overflow: auto; /* ê°€ë¡œ/ì„¸ë¡œ ëª¨ë‘ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
                max-width: 100%;
                max-height: 60vh; /* ìµœëŒ€ ë†’ì´ ì„¤ì •ìœ¼ë¡œ ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
                -webkit-overflow-scrolling: touch; /* iOS ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
            }
            
            .grid-container {
                margin: 10px 0;
                padding: 0 10px;
                overflow: visible; /* ì»¨í…Œì´ë„ˆëŠ” ìŠ¤í¬ë¡¤í•˜ì§€ ì•Šê³  ë‚´ë¶€ gridë§Œ ìŠ¤í¬ë¡¤ */
            }
        }
        
        @media (max-width: 480px) {
            .cell {
                width: calc((100vw - 60px) / 10 - 2px);
                height: calc((100vw - 60px) / 10 - 2px);
                min-width: 22px;
                min-height: 22px;
                max-width: 30px;
                max-height: 30px;
                font-size: 11px;
                border-width: 1px;
            }
            
            .grid {
                padding: 5px;
                gap: 1px;
                max-height: 55vh; /* ì‘ì€ í™”ë©´ì—ì„œëŠ” ë” ì‘ì€ ë†’ì´ */
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .grid-container {
                margin: 5px 0;
                padding: 0 5px;
                overflow: visible;
            }
        }
        
        /* í’€ì´ ëª¨ë“œ ë°˜ì‘í˜• ìµœì í™” */
        .solve-grid {
            margin: 0 auto;
            justify-self: center;
            width: fit-content;
            /* í¬ê¸°ëŠ” JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • */
        }
        
        .solve-grid .cell {
            width: 100%;
            height: 100%;
            aspect-ratio: 1;
            min-width: 20px;
            min-height: 20px;
        }
        
        /* ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ì¤‘ì•™ ì •ë ¬ ê°•í™” */
        #gridContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            width: fit-content;
        }
        
        /* í’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ê¸°ë³¸ ìŠ¤íƒ€ì¼ - ì™„ì „ ë°˜ì‘í˜• */
        .solve-layout {
            display: grid;
            grid-template-columns: var(--grid-container-width, minmax(300px, 580px)) minmax(300px, 420px);
            gap: clamp(15px, 2vw, 25px);
            margin: clamp(10px, 1.5vw, 20px) auto 0;
            justify-content: center;
            align-items: start;
            width: 100%;
            max-width: var(--layout-max-width, 1050px);
            padding: 0 clamp(10px, 2vw, 15px);
            box-sizing: border-box;
            overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš©ìœ¼ë¡œ í° ê·¸ë¦¬ë“œ ëŒ€ì‘ */
            overflow-y: visible;
        }
        
        /* ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ì™„ì „ ë°˜ì‘í˜• */
        .solve-grid-container {
            width: 100%;
            max-width: var(--dynamic-grid-max-width, 580px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: clamp(12px, 2.2vw, 20px);
            background: #f8f9fa;
            border-radius: clamp(10px, 1.8vw, 14px);
            box-sizing: border-box;
            border: 1px solid #e8ecef;
            overflow: visible; /* ê·¸ë¦¬ë“œê°€ ì˜ë¦¬ì§€ ì•Šë„ë¡ ë³€ê²½ */
        }
        
        /* ë™ì  ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .solve-grid {
            display: grid;
            gap: clamp(1px, 0.2vw, 3px);
            justify-content: center;
            align-content: center;
            width: fit-content;
            margin: clamp(10px, 2vw, 20px) auto clamp(15px, 2.5vw, 25px);
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* ë™ì  ì…€ ìŠ¤íƒ€ì¼ */
        .solve-grid .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            font-size: var(--cell-font-size);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: clamp(1px, 0.1vw, 2px) solid #333;
            border-radius: clamp(2px, 0.3vw, 4px);
            box-sizing: border-box;
            transition: all 0.2s ease;
            position: relative;
            background: white;
            cursor: pointer;
            user-select: none;
        }
        
        /* ì…€ ìˆ«ì ìŠ¤íƒ€ì¼ */
        .solve-grid .cell::before {
            content: attr(data-number);
            position: absolute;
            top: clamp(1px, 0.2vw, 2px);
            left: clamp(1px, 0.2vw, 2px);
            font-size: var(--cell-number-size);
            color: #666;
            font-weight: normal;
            line-height: 1;
        }
        
        /* ë‹¨ì–´ ì„¤ëª… ì˜ì—­ ì™„ì „ ë°˜ì‘í˜• */
        .word-clues-section {
            width: 100%;
            max-width: 420px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            border-radius: clamp(10px, 1.8vw, 14px);
            padding: clamp(12px, 2.2vw, 20px);
            box-sizing: border-box;
            border: 1px solid #e8ecef;
            overflow: hidden;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .clues-tabs {
            display: flex;
            background: #e8f4fd;
            border-radius: clamp(10px, 1.8vw, 14px);
            padding: clamp(5px, 1vw, 8px);
            margin-bottom: clamp(18px, 3vw, 25px);
            gap: clamp(5px, 1vw, 8px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .clues-tab {
            flex: 1;
            background: transparent;
            border: none;
            padding: clamp(10px, 2vw, 14px) clamp(12px, 2.5vw, 16px);
            border-radius: clamp(6px, 1vw, 8px);
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(4px, 0.8vw, 6px);
            color: #64748b;
        }
        
        .clues-tab.active {
            background: white;
            color: #1e40af;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .clues-tab:hover:not(.active) {
            background: rgba(255,255,255,0.6);
            color: #475569;
        }
        
        .clues-tab-icon {
            font-size: clamp(14px, 3vw, 16px);
        }
        
        /* íƒ­ ì½˜í…ì¸  ì˜ì—­ */
        .clues-tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(70vh - 130px);
            margin-bottom: clamp(12px, 2.2vw, 16px);
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
            border: 1px solid #e0e0e0;
            border-radius: clamp(8px, 1.2vw, 10px);
            padding: clamp(10px, 2vw, 14px);
            background: #fafafa;
            box-sizing: border-box;
        }
        
        .clues-tab-content.active {
            display: block;
        }
        
        .clues-tab-content::-webkit-scrollbar {
            width: clamp(4px, 0.8vw, 8px);
        }
        
        .clues-tab-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: clamp(2px, 0.4vw, 4px);
        }
        
        .clues-tab-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: clamp(2px, 0.4vw, 4px);
        }
        
        .clues-tab-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* ê¸°ì¡´ word-clues-containerëŠ” íƒ­ ì‹œìŠ¤í…œìœ¼ë¡œ ëŒ€ì²´ë¨ */
        
        /* ë‹¨ì–´ ì•„ì´í…œ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        .word-clue-item {
            background: white;
            padding: clamp(8px, 1.5vw, 12px);
            border-radius: clamp(6px, 1vw, 8px);
            border-left: clamp(3px, 0.6vw, 4px) solid #ddd;
            margin-bottom: clamp(6px, 1vw, 8px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.5vw, 12px);
            box-sizing: border-box;
        }
        
        .word-clue-number {
            font-weight: bold;
            min-width: clamp(18px, 3vw, 24px);
            font-size: clamp(12px, 2.2vw, 14px);
        }
        
        .word-clue-text {
            font-size: clamp(11px, 2vw, 14px);
            line-height: 1.4;
            flex: 1;
        }
        
        .word-clue-check {
            font-size: clamp(12px, 2.2vw, 16px);
        }
        
        /* ëª¨ë°”ì¼ ìµœì í™” (768px ì´í•˜) */
        @media (max-width: 768px) {
            .solve-layout {
                grid-template-columns: 1fr !important;
                gap: clamp(12px, 2.5vw, 18px) !important;
                padding: 0 clamp(8px, 2vw, 15px) !important;
                margin: clamp(8px, 1.5vw, 12px) auto 0 !important;
                max-width: calc(100vw - 16px) !important;
            }
            
            .solve-grid-container {
                order: 1;
                margin-bottom: clamp(15px, 3vw, 20px);
                max-width: calc(100vw - 32px) !important;
                width: 100% !important;
            }
            
            .word-clues-section {
                order: 2;
                max-height: 65vh !important;
                max-width: calc(100vw - 32px) !important;
                width: 100% !important;
                padding: clamp(10px, 2vw, 16px) !important;
            }
            
            .clues-tab-content {
                max-height: calc(65vh - 140px) !important;
            }
            
            :root {
                --clues-max-height: 60vh !important;
                --clues-scroll-height: 50vh !important;
            }
            
            /* ëª¨ë°”ì¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
            .solve-grid-container button {
                font-size: clamp(12px, 3vw, 14px) !important;
                padding: clamp(8px, 2vw, 12px) clamp(16px, 4vw, 20px) !important;
                margin: clamp(3px, 0.8vw, 5px) !important;
            }
            
            /* ëª¨ë°”ì¼ ë²”ë¡€ ê°œì„  */
            .solve-grid-container .legend {
                font-size: clamp(10px, 2.5vw, 12px) !important;
                gap: clamp(10px, 2vw, 15px) !important;
            }
            
            /* ëª¨ë°”ì¼ íƒ­ ìµœì í™” */
            .clues-tabs {
                flex-direction: row;
                gap: clamp(3px, 0.6vw, 5px) !important;
                padding: clamp(3px, 0.6vw, 5px) !important;
            }
            
            .clues-tab {
                padding: clamp(8px, 1.8vw, 12px) clamp(10px, 2vw, 14px) !important;
                font-size: clamp(11px, 2.2vw, 13px) !important;
                gap: clamp(3px, 0.6vw, 5px) !important;
            }
            
            .clues-tab span:last-child {
                font-size: clamp(10px, 2vw, 12px) !important;
            }
        }
        
        /* ì‘ì€ ëª¨ë°”ì¼ ìµœì í™” (480px ì´í•˜) */
        @media (max-width: 480px) {
            .solve-layout {
                gap: clamp(10px, 2.2vw, 14px) !important;
                margin: clamp(6px, 1.2vw, 10px) auto 0 !important;
                padding: 0 clamp(6px, 1.5vw, 12px) !important;
                max-width: calc(100vw - 12px) !important;
            }
            
            .solve-grid-container {
                max-width: calc(100vw - 24px) !important;
                padding: clamp(8px, 2vw, 15px) !important;
            }
            
            :root {
                --clues-max-height: 55vh !important;
                --clues-scroll-height: 45vh !important;
            }
            
            .word-clues-section {
                max-height: 55vh !important;
                max-width: calc(100vw - 24px) !important;
                width: 100% !important;
                padding: clamp(8px, 1.8vw, 14px) !important;
            }
            
            .clues-tab-content {
                max-height: calc(55vh - 110px) !important;
            }
            
            /* ì‘ì€ ëª¨ë°”ì¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
            .solve-grid-container button {
                font-size: clamp(11px, 2.8vw, 13px) !important;
                padding: clamp(6px, 1.5vw, 10px) clamp(12px, 3vw, 16px) !important;
            }
            
            /* ì‘ì€ ëª¨ë°”ì¼ ë²”ë¡€ */
            .solve-grid-container .legend {
                font-size: clamp(9px, 2.2vw, 11px) !important;
                gap: clamp(8px, 1.5vw, 12px) !important;
            }
            
            /* ì‘ì€ ëª¨ë°”ì¼ íƒ­ ìµœì í™” */
            .clues-tabs {
                gap: clamp(2px, 0.5vw, 4px) !important;
                padding: clamp(2px, 0.5vw, 4px) !important;
                margin-bottom: clamp(12px, 2.5vw, 16px) !important;
            }
            
            .clues-tab {
                padding: clamp(6px, 1.5vw, 10px) clamp(8px, 1.8vw, 12px) !important;
                font-size: clamp(10px, 2vw, 12px) !important;
                gap: clamp(2px, 0.5vw, 4px) !important;
            }
            
            .clues-tab span:last-child {
                font-size: clamp(9px, 1.8vw, 11px) !important;
            }
            
            .clues-tab-icon {
                font-size: clamp(11px, 2.2vw, 13px) !important;
            }
        }
        
        /* CSS ë³€ìˆ˜ ì •ì˜ */
        :root {
            --cell-size: 30px;
            --cell-font-size: 14px;
            --cell-number-size: 8px;
            --label-padding: 2px;
            --label-min-width: 10px;
            --label-border-radius: 2px;
            --label-offset: 12px;
            --clues-max-height: 70vh;
            --clues-scroll-height: 60vh;
        }
        
        /* ì¤‘í˜• í™”ë©´ ìµœì í™” (1000px ì´ìƒ) */
        @media (min-width: 1000px) {
            .solve-layout {
                max-width: var(--layout-max-width, 1200px);
                gap: 20px;
            }
            
            .solve-grid-container {
                max-width: var(--dynamic-grid-max-width, 650px);
            }
            
            .word-clues-section {
                max-width: 420px;
            }
        }
        
        /* ëŒ€í˜• í™”ë©´ ìµœì í™” (1200px ì´ìƒ) */
        @media (min-width: 1200px) {
            .solve-layout {
                max-width: var(--layout-max-width, 1300px);
                gap: 22px;
                margin: 15px auto 0;
                padding: 0 12px;
            }
            
            .solve-grid-container {
                max-width: var(--dynamic-grid-max-width, 700px);
                padding: 18px;
            }
            
            .word-clues-section {
                max-width: 420px;
                padding: 18px;
            }
            
            .clues-tab-content {
                padding: 14px;
                border-radius: 8px;
                max-height: calc(75vh - 140px);
            }
        }
        
        /* ì´ˆëŒ€í˜• í™”ë©´ ì œí•œ (1400px ì´ìƒ) */
        @media (min-width: 1400px) {
            .solve-layout {
                max-width: var(--layout-max-width, 1350px);
            }
            
            .solve-grid-container {
                max-width: var(--dynamic-grid-max-width, 750px);
            }
            
            .word-clues-section {
                max-width: 420px;
            }
        }
        
        /* ë™ì  í¬ê¸° ì¡°ì •ì„ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        .solve-grid-actions {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(8px, 1.5vw, 12px);
            justify-content: center;
            align-items: center;
            padding-top: clamp(12px, 2vw, 18px);
            margin-top: auto;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        
        .solve-grid-legend {
            display: flex;
            gap: clamp(10px, 2vw, 15px);
            align-items: center;
            justify-content: center;
            font-size: clamp(10px, 2vw, 12px);
            margin-top: clamp(8px, 1.5vw, 12px);
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: clamp(4px, 0.8vw, 6px);
        }
        
        .legend-color {
            width: clamp(10px, 2vw, 12px);
            height: clamp(10px, 2vw, 12px);
            border-radius: clamp(1px, 0.2vw, 2px);
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        /* ì œì‘ ëª¨ë“œ ì¶”ê°€ ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .grid {
                max-width: calc(100vw - clamp(40px, 8vw, 60px));
                margin: 0 auto;
            }
            
            .word-list {
                max-height: clamp(200px, 40vh, 300px);
                overflow-y: auto;
            }
            
            /* í€´ì¦ˆ ì œëª© ì…ë ¥ */
            .quiz-title {
                font-size: clamp(12px, 3vw, 16px) !important;
                padding: clamp(8px, 2vw, 12px) !important;
            }
            
            /* ì…ë ¥ ê·¸ë£¹ë“¤ */
            .input-group {
                margin-bottom: clamp(8px, 2vw, 12px);
            }
            
            .input-group input {
                font-size: clamp(12px, 2.8vw, 14px);
                padding: clamp(6px, 1.5vw, 10px);
            }
            
            .input-group select {
                font-size: clamp(12px, 2.8vw, 14px);
                padding: clamp(6px, 1.5vw, 10px);
            }
        }
        
        @media (max-width: 480px) {
            .grid {
                max-width: calc(100vw - clamp(30px, 6vw, 40px));
            }
            
            .word-list {
                max-height: clamp(180px, 35vh, 250px);
            }
            
            /* í€´ì¦ˆ ì œëª© ì…ë ¥ */
            .quiz-title {
                font-size: clamp(11px, 2.5vw, 14px) !important;
                padding: clamp(6px, 1.5vw, 10px) !important;
            }
            
            /* ì…ë ¥ í•„ë“œë“¤ */
            .input-group input {
                font-size: 12px !important;
                padding: 6px !important;
            }
            
            .input-group select {
                font-size: 12px !important;
                padding: 6px !important;
            }
            
            /* ë²„íŠ¼ë“¤ */
            button {
                font-size: 12px !important;
                padding: 6px 10px !important;
            }
            
            /* í—¤ë” */
            .header h1 {
                font-size: 18px !important;
            }
            
                         .mode-badge {
                 font-size: 12px !important;
                 padding: 8px 12px !important;
             }
        }
        
        /* í€´ì¦ˆ ì½”ë“œ ì…ë ¥ í™”ë©´ ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            /* ì½”ë“œ ì…ë ¥ ë°•ìŠ¤ */
            div[style*="max-width: 500px"] {
                max-width: calc(100vw - 40px) !important;
                margin: 20px auto !important;
                padding: 20px !important;
            }
            
            /* ì½”ë“œ ì…ë ¥ í•„ë“œ */
            #codeInput {
                font-size: 16px !important;
                padding: 12px !important;
            }
        }
        
        @media (max-width: 480px) {
            /* ì½”ë“œ ì…ë ¥ ë°•ìŠ¤ */
            div[style*="max-width: 500px"] {
                max-width: calc(100vw - 20px) !important;
                margin: 10px auto !important;
                padding: 15px !important;
            }
            
            /* ì½”ë“œ ì…ë ¥ í•„ë“œ */
            #codeInput {
                font-size: 14px !important;
                padding: 10px !important;
            }
            
            /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì ˆ */
            div[style*="font-size: 4rem"] {
                font-size: 3rem !important;
            }
        }

        /* ë ˆê±°ì‹œ CSS ì œê±°ë¨ - ìƒˆë¡œìš´ ì™„ì „ ë°˜ì‘í˜• ì‹œìŠ¤í…œìœ¼ë¡œ ëŒ€ì²´ */
        
        .cell.empty {
            background: #e0e0e0;
            border-color: #999;
        }
        
        .cell:hover:not(.empty) {
            background: #f0f4ff;
            transform: scale(1.05);
        }
        
        .cell.selected {
            background: #667eea !important;
            color: white;
        }
        
        /* ëª¨ë°”ì¼ í„°ì¹˜ ë“œë˜ê·¸ ìŠ¤íƒ€ì¼ */
        .cell.drop-target {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9) !important;
            border-color: #4CAF50 !important;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
            transform: scale(1.05);
            animation: dropTargetPulse 1s ease-in-out infinite;
        }
        
        /* í„°ì¹˜ ë“œë˜ê·¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes dragBounce {
            0% {
                transform: rotate(-3deg) scale(0.8);
                opacity: 0.8;
            }
            50% {
                transform: rotate(-1deg) scale(1.1);
            }
            100% {
                transform: rotate(-3deg) scale(1);
                opacity: 1;
            }
        }
        
        @keyframes dropTargetPulse {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.3);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(76, 175, 80, 0.5);
            }
        }
        
        @keyframes feedbackPop {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            15% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 1;
            }
            25% {
                transform: translate(-50%, -50%) scale(1);
            }
            85% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* í„°ì¹˜ í–¥ìƒì„ ìœ„í•œ ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .cell {
                user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
                -webkit-user-select: none;
                -webkit-touch-callout: none; /* iOS ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë°©ì§€ */
                -webkit-tap-highlight-color: transparent; /* í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
            }
            
            .grid {
                touch-action: pan-x pan-y; /* ê·¸ë¦¬ë“œ ì˜ì—­ì—ì„œëŠ” ìŠ¤í¬ë¡¤ í—ˆìš© */
            }
        }
        
        /* í’€ì´ ëª¨ë“œ ê·¸ë¦¬ë“œ ì…€ ìŠ¤íƒ€ì¼ë§ */
        .solve-grid-cell {
            position: relative;
            border-radius: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .solve-grid-cell input {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            background: transparent;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            caret-color: transparent; /* ê¸°ë³¸ ì»¤ì„œ ìˆ¨ê¹€ */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* í¬ì»¤ìŠ¤ëœ ì…€ì˜ ì„¸ë ¨ëœ íš¨ê³¼ */
        .solve-grid-cell.focused {
            background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%) !important;
            border: 2px solid #2196F3 !important;
            box-shadow: 
                0 0 0 3px rgba(33, 150, 243, 0.1),
                0 4px 20px rgba(33, 150, 243, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transform: scale(1.02);
            z-index: 10;
        }
        
        /* ê¸€ë¡œìš° ì• ë‹ˆë©”ì´ì…˜ */
        .solve-grid-cell.focused::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, rgba(33, 150, 243, 0.2), rgba(100, 181, 246, 0.3), rgba(33, 150, 243, 0.2));
            border-radius: 8px;
            z-index: -1;
            opacity: 0.3;
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% {
                opacity: 0.2;
                transform: scale(1);
            }
            50% {
                opacity: 0.4;
                transform: scale(1.01);
            }
        }
        
        /* ì™„ì„±ëœ ë‹¨ì–´ì˜ ì…€ ìŠ¤íƒ€ì¼ */
        .solve-grid-cell.correct {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%) !important;
            border-color: #4CAF50 !important;
            color: #2e7d32;
        }
        
        /* í‹€ë¦° ë‹µì˜ ì…€ ìŠ¤íƒ€ì¼ */
        .solve-grid-cell.incorrect {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%) !important;
            border-color: #f39c12 !important;
            color: #d68910;
        }
        
        .word-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .word-item {
            background: linear-gradient(135deg, #fff 0%, #f8faff 100%);
            padding: clamp(12px, 3vw, 18px);
            margin: clamp(8px, 2vw, 12px) 0;
            border-radius: 16px;
            border: 1px solid rgba(76, 175, 80, 0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .word-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 0 2px 2px 0;
        }
        
        .word-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .word-item.unplaced {
            border-color: rgba(244, 67, 54, 0.2);
            background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
        }
        
        .word-item.unplaced::before {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .word-item.selected {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8faff 100%);
            border-color: rgba(33, 150, 243, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(33, 150, 243, 0.15);
        }
        
        .word-item.selected::before {
            background: linear-gradient(135deg, #2196F3, #1976d2);
        }
        
        .word-text {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .word-hint {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .word-meta {
            font-size: 12px;
            color: #999;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        

        
        .manual-mode-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
            text-align: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: clamp(10px, 2vw, 15px);
            margin: clamp(15px, 3vw, 20px) 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f8faff 100%);
            padding: clamp(12px, 3vw, 18px);
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.15);
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .stat-number {
            font-size: clamp(20px, 4vw, 28px);
            font-weight: 700;
            color: #667eea;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: clamp(10px, 2vw, 12px);
            color: #6c757d;
            margin-top: 4px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .cell {
                width: 30px;
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§© ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°</h1>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="createModeBtn" class="mode-badge" style="cursor: pointer; border: none; font-size: 1rem;">
                    ğŸ“ ì œì‘ ëª¨ë“œ
                </button>
                <button id="solveModeBtn" class="mode-badge" style="cursor: pointer; border: none; background: linear-gradient(45deg, #2196F3, #1976D2); font-size: 1rem;">
                    ğŸ® í’€ì´ ëª¨ë“œ
                </button>
            </div>
        </div>
        

        
        <div style="margin-bottom: 20px;">
            <label for="quizTitle" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-size: 14px;">í€´ì¦ˆëª…</label>
            <input type="text" id="quizTitle" class="quiz-title" placeholder="í€´ì¦ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ìš°ë¦¬ë°˜ ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ)" value="ìš°ë¦¬ë°˜ ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ">
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalWords">0</div>
                <div class="stat-label">ì „ì²´ ë‹¨ì–´</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="placedWords">0</div>
                <div class="stat-label">ë°°ì¹˜ëœ ë‹¨ì–´</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="gridSize">10Ã—10</div>
                <div class="stat-label">ê·¸ë¦¬ë“œ í¬ê¸°</div>
            </div>
        </div>
        
        <div class="main-layout">
            <div class="word-panel">
                <h3 class="panel-title">ğŸ“ ë‹¨ì–´ ê´€ë¦¬</h3>
                
                <div class="form-group">
                    <label class="form-label">ë‹¨ì–´</label>
                    <input type="text" id="wordInput" class="form-input" placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                                    <label class="form-label">ì„¤ëª…</label>
                <input type="text" id="hintInput" class="form-input" placeholder="ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ë°©í–¥</label>
                    <select id="directionSelect" class="form-select">
                        <option value="horizontal">â¡ï¸ ê°€ë¡œ</option>
                        <option value="vertical">â¬‡ï¸ ì„¸ë¡œ</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="addWord()" style="width: 100%; margin: 0;">â• ë‹¨ì–´ ì¶”ê°€</button>
                
                <div style="margin-top: 20px; display: flex; gap: 8px;">
                    <div style="flex: 1; position: relative;">
                        <input type="file" id="excel-upload-main" accept=".xlsx,.xls" onchange="handleExcelUpload(event)" 
                               style="position: absolute; inset: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                        <button class="btn" style="width: 100%; margin: 0; background: linear-gradient(135deg, #16a085, #138d75); color: white; padding: 8px 12px; font-size: 13px;" 
                                onclick="document.getElementById('excel-upload-main').click()">
                            ğŸ“Š ë‹¨ì–´ ì¼ê´„ ì—…ë¡œë“œ
                        </button>
                    </div>
                    
                    <div style="flex: 1;">
                        <button class="btn" style="width: 100%; margin: 0; background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 8px 12px; font-size: 13px;" 
                                onclick="downloadExcelTemplate()">
                            ğŸ“¥ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
                
                <div style="margin-top: 20px; background: #e3f2fd; padding: 15px; border-radius: 10px; border: 2px solid #2196F3;">
                    <h4 style="color: #1976D2; margin-bottom: 10px; font-size: 14px;">ğŸ’¡ ë‹¨ì–´ ë°°ì¹˜ ë°©ë²•</h4>
                    <ul style="color: #1976D2; font-size: 12px; margin: 0; padding-left: 15px;">
                        <li>ë‹¨ì–´ë¥¼ ì„ íƒí•œ í›„ ê·¸ë¦¬ë“œì˜ ì›í•˜ëŠ” ìœ„ì¹˜ë¥¼ í´ë¦­</li>
                        <li>ìë™ ë°°ì¹˜ í›„ ê·¸ë¦¬ë“œì—ì„œ ë“œë˜ê·¸ë¡œ ìœ„ì¹˜ ë³€ê²½</li>
                        <li>ë°©í–¥ ì „í™˜ ë²„íŠ¼ìœ¼ë¡œ ê°€ë¡œ/ì„¸ë¡œ ì „í™˜</li>
                    </ul>
                </div>
                
                <div class="word-list" id="wordList">
                    <!-- ë‹¨ì–´ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div class="grid-panel">
                <h3 class="panel-title">ğŸ¯ í€´ì¦ˆ ê·¸ë¦¬ë“œ</h3>
                
                <div class="grid-size-controls">
                    <span>ê·¸ë¦¬ë“œ í¬ê¸°:</span>
                    <input type="number" id="gridRows" class="size-input" value="10" min="5" max="20" onchange="updateGridSize()">
                    <span>Ã—</span>
                    <input type="number" id="gridCols" class="size-input" value="10" min="5" max="20" onchange="updateGridSize()">
                    <div style="font-size: clamp(9px, 2vw, 11px); color: #666; margin-top: 5px; text-align: center;">
                        ìµœì†Œ 5Ã—5 ìµœëŒ€ 20Ã—20
                    </div>
                </div>
                
                <div class="grid-controls">
                    <button class="btn btn-success" onclick="autoPlaceWords()">ğŸ² ìë™ ë°°ì¹˜</button>
                    <button class="btn btn-secondary" onclick="clearGrid()">ğŸ—‘ï¸ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”</button>
                    <button class="btn btn-secondary" onclick="shareQuiz()">ğŸ“¤ ê³µìœ í•˜ê¸°</button>
                    
                </div>
                
                <div class="grid-container">
                    <div class="grid" id="grid" data-grid-container="true">
                        <!-- ê·¸ë¦¬ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let words = [];
        let grid = Array(10).fill(null).map(() => Array(10).fill(''));
        let gridSize = { rows: 10, cols: 10 };
        let mode = 'create';
        let selectedWordForPlacement = null;
        let playerGrid = Array(10).fill(null).map(() => Array(10).fill(''));
        let completedWords = new Set();
        let missionCompleted = false;
        let wordNumbers = {};
        let activeInputField = null;
        let isComposing = false;
        
        // ğŸ”’ ê³µìœ ë°›ì€ ìƒíƒœ ì¶”ì  ë³€ìˆ˜ (ë³´ì•ˆ ê°œì„ )
        let isSharedQuizMode = false;
        let sharedQuizData = null;

        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„° ì‹œì‘!');
            initializeGrid();
            addSampleWords();
            updateStats();
            
            // ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ˆê¸° í˜ì´ì§€ìš©)
            document.getElementById('createModeBtn').addEventListener('click', () => switchMode('create'));
            document.getElementById('solveModeBtn').addEventListener('click', () => switchMode('codeInput'));
        });
        


        // ========== í€´ì¦ˆ í’€ì´ ê´€ë ¨ í•¨ìˆ˜ ==========
        function generateWordNumbers(wordsData) {
            const numbers = {};
            let horizontalIndex = 1;
            let verticalIndex = 1;
            
            const placedWords = wordsData.filter(w => w.placed);
            const horizontalWords = placedWords.filter(w => w.direction === 'horizontal')
                .sort((a, b) => a.startRow === b.startRow ? a.startCol - b.startCol : a.startRow - b.startRow);
            const verticalWords = placedWords.filter(w => w.direction === 'vertical')
                .sort((a, b) => a.startCol === b.startCol ? a.startRow - b.startRow : a.startCol - b.startCol);
            
            horizontalWords.forEach(word => {
                numbers[word.id] = { direction: 'horizontal', number: horizontalIndex++ };
            });
            
            verticalWords.forEach(word => {
                numbers[word.id] = { direction: 'vertical', number: verticalIndex++ };
            });
            
            return numbers;
        }

        function checkWordCompletion(wordData) {
            const { word, startRow, startCol, direction } = wordData;
            for (let i = 0; i < word.length; i++) {
                const row = direction === 'horizontal' ? startRow : startRow + i;
                const col = direction === 'horizontal' ? startCol + i : startCol;
                if (playerGrid[row][col] !== word[i]) {
                    return false;
                }
            }
            return true;
        }

        function checkMissionComplete() {
            const placedWords = words.filter(w => w.placed);
            const completedCount = placedWords.filter(w => checkWordCompletion(w)).length;
            
            if (completedCount === placedWords.length && placedWords.length > 0) {
                if (!missionCompleted) {
                    missionCompleted = true;
                    setTimeout(() => {
                        alert('ğŸ‰ ë¯¸ì…˜ ì„±ê³µ!\n\nëª¨ë“  í€´ì¦ˆ ì™„ë£Œ! ğŸ‘');
                    }, 300);
                }
            } else {
                missionCompleted = false;
            }
        }

        function getCellWordInfo(row, col) {
            for (const word of words.filter(w => w.placed)) {
                for (let i = 0; i < word.word.length; i++) {
                    const wordRow = word.direction === 'horizontal' ? word.startRow : word.startRow + i;
                    const wordCol = word.direction === 'horizontal' ? word.startCol + i : word.startCol;
                    if (wordRow === row && wordCol === col) {
                        const isCompleted = checkWordCompletion(word);
                        const isCorrect = playerGrid[row][col] === word.word[i];
                        return { word, isCompleted, isCorrect, hasContent: playerGrid[row][col] !== '' };
                    }
                }
            }
            return null;
        }

        // í˜„ì¬ í™œì„±í™”ëœ ì…ë ¥ í•„ë“œ ì¶”ì  (ì´ë¯¸ ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸ë¨)

        // í•œê¸€ê³¼ ì˜ì–´ë¥¼ ëª¨ë‘ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
        function processInputValue(value) {
            if (!value) return '';
            const firstChar = value.charAt(0);
            // í•œê¸€ ì™„ì„± ë¬¸ì ë²”ìœ„ í™•ì¸ (ê°€-í£)
            if (firstChar >= 'ê°€' && firstChar <= 'í£') {
                return firstChar; // ì™„ì„±ëœ í•œê¸€ì€ ê·¸ëŒ€ë¡œ
            }
            // ì˜ì–´ëŠ” ëŒ€ë¬¸ìë¡œ
            if (/[a-zA-Z]/.test(firstChar)) {
                return firstChar.toUpperCase();
            }
            // ìˆ«ìë‚˜ ê¸°íƒ€ ë¬¸ì
            return firstChar;
        }

        // ì „ì—­ í´ë¦­ ì´ë²¤íŠ¸ë¡œ í¬ì»¤ìŠ¤ ê´€ë¦¬
        document.addEventListener('click', function(event) {
            // ê·¸ë¦¬ë“œ ì˜ì—­ ì™¸ë¶€ í´ë¦­ ì‹œ í™œì„± ì…ë ¥ í•„ë“œ í•´ì œ
            const gridContainer = event.target.closest('[data-grid-container]');
            const isInputField = event.target.tagName === 'INPUT';
            
            if (!gridContainer && !isInputField && activeInputField) {
                const activeElement = document.querySelector(`[data-cell="${activeInputField}"] input`);
                if (activeElement) {
                    activeElement.blur();
                }
                activeInputField = null;
            }
        });

        function handleInputChange(row, col, value) {
            if (mode === 'solve') {
                playerGrid[row][col] = processInputValue(value);
                
                setTimeout(() => {
                    const updatedCompleted = new Set();
                    words.filter(w => w.placed).forEach(word => {
                        if (checkWordCompletion(word)) {
                            updatedCompleted.add(word.id);
                        }
                    });
                    completedWords = updatedCompleted;
                    checkMissionComplete();
                    updateSolveGridDisplay();
                }, 100);
            }
        }
        
        // ========== ëª¨ë“œ ì „í™˜ ==========
        function switchMode(newMode) {
            mode = newMode;
            updateModeButtons();
            
            if (mode === 'create') {
                showCreateMode();
            } else if (mode === 'codeInput') {
                showCodeInputMode();
            } else if (mode === 'solve') {
                showSolveMode();
            }
        }
        
        // í€´ì¦ˆ ì½”ë“œ ì…ë ¥ í™”ë©´ì—ì„œ ì œì‘ ëª¨ë“œ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
        function handleCreateModeClick() {
            console.log('ì½”ë“œ ì…ë ¥ ëª¨ë“œì—ì„œ ì œì‘ ëª¨ë“œë¡œ ì „í™˜ - ìƒˆë¡œìš´ í€´ì¦ˆ ì‹œì‘');
            
            // ëª¨ë“  ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
            words = [];
            grid = Array(10).fill(null).map(() => Array(10).fill(''));
            gridSize = { rows: 10, cols: 10 };
            selectedWordForPlacement = null;
            
            // ê³µìœ ë°›ì€ ìƒíƒœ í•´ì œ
            isSharedQuizMode = false;
            sharedQuizData = null;
            
            // URL íŒŒë¼ë¯¸í„° ì œê±°
            window.history.replaceState({}, document.title, window.location.pathname);
            
            switchMode('create');
        }

        // í’€ì´ ëª¨ë“œì—ì„œ ì œì‘ ëª¨ë“œë¡œ ì „í™˜ ì‹œ í™•ì¸ ëŒ€í™”ìƒì
        function confirmSwitchToCreate() {
            let confirmMessage;
            
            // ê³µìœ ë°›ì€ í€´ì¦ˆì¸ì§€ í™•ì¸í•˜ì—¬ ë‹¤ë¥¸ ë©”ì‹œì§€ í‘œì‹œ
            if (isSharedQuizMode) {
                confirmMessage = 'ìƒˆë¡œìš´ í€´ì¦ˆë¥¼ ì œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nâœ¨ ë‚˜ë§Œì˜ í€´ì¦ˆë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!';
            } else {
                confirmMessage = 'ì œì‘ ëª¨ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?\n\n âš ï¸ ì£¼ì˜: í˜„ì¬ í’€ì´í•˜ë˜ ë‚´ìš©ì´ ëª¨ë‘ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\nì§„í–‰ ìƒí™©ì´ ì‚¬ë¼ì ¸ë„ ê´œì°®ìœ¼ì‹œë©´ "í™•ì¸"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
            }
            
            const confirmSwitch = confirm(confirmMessage);
            
            if (confirmSwitch) {
                console.log('ì œì‘ ëª¨ë“œë¡œ ì „í™˜ ì‹œì‘'); // ë””ë²„ê·¸ ë¡œê·¸
                
                // ê³µìœ ë°›ì€ í€´ì¦ˆì¸ ê²½ìš° ì™„ì „ ì´ˆê¸°í™”
                if (isSharedQuizMode) {
                    console.log('ğŸ”’ ê³µìœ ë°›ì€ í€´ì¦ˆì—ì„œ ì œì‘ëª¨ë“œë¡œ ì „í™˜ - ì™„ì „ ì´ˆê¸°í™”');
                    
                    // ëª¨ë“  ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
                    words = [];
                    grid = Array(10).fill(null).map(() => Array(10).fill(''));
                    gridSize = { rows: 10, cols: 10 };
                    selectedWordForPlacement = null;
                    
                    // ê³µìœ ë°›ì€ ìƒíƒœ í•´ì œ
                    isSharedQuizMode = false;
                    sharedQuizData = null;
                    
                    // URL íŒŒë¼ë¯¸í„° ì œê±°
                    window.history.replaceState({}, document.title, window.location.pathname);
                } else {
                    console.log('ê¸°ì¡´ í€´ì¦ˆì—ì„œ ì œì‘ëª¨ë“œë¡œ ì „í™˜ - í’€ì´ ì§„í–‰ìƒí™©ë§Œ ì´ˆê¸°í™”');
                }
                
                // í’€ì´ ì§„í–‰ìƒí™© ì´ˆê¸°í™”
                playerGrid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
                completedWords = new Set();
                missionCompleted = false;
                activeInputField = null;
                
                // ê°•ì œë¡œ ì œì‘ ëª¨ë“œë¡œ ì „í™˜
                mode = 'create';
                console.log('ëª¨ë“œ ë³€ê²½ë¨:', mode); // ë””ë²„ê·¸ ë¡œê·¸
                
                // DOM ê°•ì œ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    try {
                        showCreateMode();
                        console.log('ì œì‘ ëª¨ë“œ í™”ë©´ í‘œì‹œ ì™„ë£Œ'); // ë””ë²„ê·¸ ë¡œê·¸
                        
                    } catch (error) {
                        console.error('ì œì‘ ëª¨ë“œ í‘œì‹œ ì¤‘ ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                        window.location.reload();
                    }
                }, 100);
            } else {
                console.log('ëª¨ë“œ ì „í™˜ ì·¨ì†Œë¨'); // ë””ë²„ê·¸ ë¡œê·¸
            }
        }

        

        function showCreateMode() {
            // ï¿½ï¿½ ë³´ì•ˆ ì²´í¬: ê³µìœ ë°›ì€ ìƒíƒœì—ì„œ ì œì‘ëª¨ë“œë¡œ ì´ë™ ì‹œ ì´ˆê¸°í™”
            if (isSharedQuizMode) {
                console.log('ğŸ”’ ê³µìœ ë°›ì€ í€´ì¦ˆì—ì„œ ì œì‘ëª¨ë“œ ì ‘ê·¼ - ë°ì´í„° ì´ˆê¸°í™”');
                
                // ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
                words = [];
                grid = Array(10).fill(null).map(() => Array(10).fill(''));
                gridSize = { rows: 10, cols: 10 };
                selectedWordForPlacement = null;
                
                // ì œì‘ëª¨ë“œ ì´ˆê¸° ìƒíƒœë¡œ ë³µì›
                const titleInputElement = document.getElementById('quizTitle');
                if (titleInputElement) {
                    titleInputElement.value = '';
                }
                
                // ê³µìœ ë°›ì€ ìƒíƒœ í•´ì œ
                isSharedQuizMode = false;
                sharedQuizData = null;
                
                // URL íŒŒë¼ë¯¸í„° ì œê±° (ê¹”ë”í•œ URL)
                window.history.replaceState({}, document.title, window.location.pathname);
                
                alert('ìƒˆë¡œìš´ í€´ì¦ˆë¡œ ì‹œì‘ë©ë‹ˆë‹¤! âœ¨');
            }
            
            mode = 'create';
            
            // ì œëª© í•„ë“œ ì´ˆê¸°í™” (ëª¨ë“  ê²½ìš°ì— ì ìš©)
            const titleInput = document.getElementById('quizTitle');
            if (titleInput) {
                titleInput.value = '';
            }
            
            // DOM ìš”ì†Œë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (í€´ì¦ˆ ì½”ë“œ ì…ë ¥ í™”ë©´ì—ì„œ ì˜¤ëŠ” ê²½ìš° ì—†ì„ ìˆ˜ ìˆìŒ)
            const createModeElement = document.getElementById('createMode');
            const solveModeElement = document.getElementById('solveMode');
            const createBtnElement = document.getElementById('createBtn');
            const solveBtnElement = document.getElementById('solveBtn');
            
            // ê¸°ë³¸ ì œì‘ ëª¨ë“œ ìš”ì†Œë“¤ì´ ì—†ìœ¼ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì´ˆê¸° ìƒíƒœë¡œ ëŒì•„ê°
            if (!createModeElement || !solveModeElement) {
                console.log('ì œì‘ ëª¨ë“œ ìš”ì†Œê°€ ì—†ìŒ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                window.location.reload();
                return;
            }
            
            createModeElement.style.display = 'block';
            solveModeElement.style.display = 'none';
            
            if (createBtnElement) createBtnElement.classList.add('active');
            if (solveBtnElement) solveBtnElement.classList.remove('active');
            
            console.log('ì œì‘ ëª¨ë“œë¡œ ì „í™˜');
            
            // í•¨ìˆ˜ë“¤ì„ ì•ˆì „í•˜ê²Œ í˜¸ì¶œ (ìš”ì†Œê°€ ì¡´ì¬í•  ë•Œë§Œ)
            try {
                updateGrid();
                updateWordList();
                updateStats();
            } catch (error) {
                console.error('ì œì‘ ëª¨ë“œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function showCodeInputMode() {
            document.querySelector('.container').innerHTML = `
                <div class="header">
                    <h1>ğŸ§© ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°</h1>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="handleCreateModeClick()" class="mode-badge" style="cursor: pointer; border: none; font-size: 1rem; opacity: 0.7; background: linear-gradient(45deg, #4CAF50, #45a049);">
                            ğŸ“ ì œì‘ ëª¨ë“œ
                        </button>
                        <button onclick="switchMode('codeInput')" class="mode-badge" style="cursor: pointer; border: none; background: linear-gradient(45deg, #2196F3, #1976D2); font-size: 1rem; opacity: 1;">
                            ğŸ® í’€ì´ ëª¨ë“œ
                        </button>
                    </div>
                </div>
                
                <div style="max-width: 500px; margin: 40px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ”</div>
                        <h2 style="color: #333; margin-bottom: 10px;">í€´ì¦ˆ ì½”ë“œ ì…ë ¥</h2>
                        <p style="color: #666;">ê³µìœ ë°›ì€ í€´ì¦ˆ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <input type="text" id="codeInput" placeholder="í€´ì¦ˆ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                               style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 18px; text-align: center; font-family: monospace; text-transform: uppercase;">
                    </div>
                    
                    <div style="display: flex; justify-content: center;">
                        <button onclick="loadQuizFromCode()" style="padding: 15px 30px; background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;">
                            ğŸš€ í€´ì¦ˆ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </div>
            `;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì „ì—­ì—ì„œ ì´ë¯¸ ì„¤ì •ë¨
        }
        
        function updateModeButtons() {
            const createBtn = document.getElementById('createModeBtn');
            const solveBtn = document.getElementById('solveModeBtn');
            
            // ë²„íŠ¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í‚µ (í€´ì¦ˆ ì½”ë“œ ì…ë ¥ í™”ë©´ ë“±)
            if (!createBtn || !solveBtn) {
                return;
            }
            
            if (mode === 'create') {
                createBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                solveBtn.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
                solveBtn.style.opacity = '0.7';
                createBtn.style.opacity = '1';
            } else {
                createBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                createBtn.style.opacity = '0.7';
                solveBtn.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
                solveBtn.style.opacity = '1';
            }
        }
        
        function addSampleWords() {
            const samples = [
                { word: 'í•™êµ', hint: 'í•™ìƒë“¤ì´ ê³µë¶€í•˜ëŠ” ê³³' },
                { word: 'ì„ ìƒë‹˜', hint: 'í•™ìƒë“¤ì„ ê°€ë¥´ì¹˜ëŠ” ë¶„' },
                { word: 'ì¹œêµ¬', hint: 'í•¨ê»˜ ë†€ê³  ê³µë¶€í•˜ëŠ” ì‚¬ëŒ' }
            ];
            
            setTimeout(() => {
                samples.forEach((sample, index) => {
                    setTimeout(() => {
                        const word = {
                            id: Date.now() + index,
                            word: sample.word.toUpperCase(),
                            hint: sample.hint,
                            direction: index % 2 === 0 ? 'horizontal' : 'vertical',
                            placed: false,
                            startRow: 0,
                            startCol: 0
                        };
                        words.push(word);
                        updateWordList();
                        updateStats();
                    }, index * 500);
                });
            }, 1000);
        }
        
        // ========== ê·¸ë¦¬ë“œ ê´€ë¦¬ ==========
        function initializeGrid() {
            grid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
            createGridDOM();
        }
        
        function createGridDOM() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = '';
            gridElement.style.gridTemplateColumns = `repeat(${gridSize.cols}, 1fr)`;
            
            for (let row = 0; row < gridSize.rows; row++) {
                for (let col = 0; col < gridSize.cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell empty';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬í†±)
                    cell.onclick = () => handleCellClick(row, col);
                    cell.ondragstart = (e) => handleDragStart(e, row, col);
                    cell.ondrop = (e) => handleDrop(e, row, col);
                    cell.ondragover = handleDragOver;
                    cell.draggable = true;
                    
                    // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼) - passive: falseë¡œ preventDefault í—ˆìš©
                    cell.addEventListener('touchstart', (e) => handleTouchStart(e, row, col), { passive: false });
                    cell.addEventListener('touchmove', (e) => handleTouchMove(e, row, col), { passive: false });
                    cell.addEventListener('touchend', (e) => handleTouchEnd(e, row, col), { passive: false });
                    
                    gridElement.appendChild(cell);
                }
            }
            updateGridDisplay();
        }
        
        function updateGridSize() {
            const rows = Math.max(5, Math.min(20, parseInt(document.getElementById('gridRows').value)));
            const cols = Math.max(5, Math.min(20, parseInt(document.getElementById('gridCols').value)));
            
            gridSize = { rows, cols };
            
            // ê¸°ì¡´ ë‹¨ì–´ë“¤ì˜ ë°°ì¹˜ ìƒíƒœ ì´ˆê¸°í™”
            words.forEach(word => {
                if (word.placed) {
                    const maxRow = word.direction === 'horizontal' ? rows : rows - word.word.length;
                    const maxCol = word.direction === 'horizontal' ? cols - word.word.length : cols;
                    
                    if (word.startRow >= maxRow || word.startCol >= maxCol) {
                        word.placed = false;
                    }
                }
            });
            
            initializeGrid();
            updateWordList();
            updateStats();
            
            // DOM ìš”ì†Œ ì¡´ì¬ í™•ì¸ í›„ ì—…ë°ì´íŠ¸
            const gridSizeEl = document.getElementById('gridSize');
            if (gridSizeEl) gridSizeEl.textContent = `${cols}Ã—${rows}`;
        }
        
        function updateGridDisplay() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const letter = grid[row][col];
                
                if (letter) {
                    cell.className = 'cell';
                    cell.textContent = letter;
                    cell.draggable = true;
                    cell.style.cursor = 'move';
                } else {
                    cell.className = 'cell empty';
                    cell.textContent = '';
                    cell.draggable = false;
                    cell.style.cursor = 'pointer';
                }
            });
        }
        
        // ========== ë‹¨ì–´ ê´€ë¦¬ ==========
        function addWord() {
            const wordInput = document.getElementById('wordInput');
            const hintInput = document.getElementById('hintInput');
            const directionSelect = document.getElementById('directionSelect');
            
            const wordText = wordInput.value.trim().toUpperCase();
            const hintText = hintInput.value.trim();
            
            if (!wordText || !hintText) {
                alert('ë‹¨ì–´ì™€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”!');
                if (!wordText) {
                    wordInput.focus();
                } else {
                    hintInput.focus();
                }
                return;
            }
            
            if (wordText.length > Math.max(gridSize.rows, gridSize.cols)) {
                alert(`ë‹¨ì–´ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤! (ìµœëŒ€ ${Math.max(gridSize.rows, gridSize.cols)}ê¸€ì)`);
                return;
            }
            
            const word = {
                id: Date.now(),
                word: wordText,
                hint: hintText,
                direction: directionSelect.value,
                placed: false,
                startRow: 0,
                startCol: 0
            };
            
            words.push(word);
            updateWordList();
            updateStats();
            
            // ë°±ì—… ì €ì¥
            try {
                localStorage.setItem('crossword_words_backup_vanilla', JSON.stringify(words));
                console.log(`ë‹¨ì–´ ì¶”ê°€ë¨ ë° ë°±ì—… ì €ì¥: ${word.word}`);
            } catch (error) {
                console.error('ë°±ì—… ì €ì¥ ì‹¤íŒ¨:', error);
            }
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            wordInput.value = '';
            hintInput.value = '';
            wordInput.focus();
        }
        
        function deleteWord(id) {
            if (confirm('ì´ ë‹¨ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                words = words.filter(word => word.id !== id);
                regenerateGrid();
                updateWordList();
                updateStats();
                
                // ë°±ì—… ì €ì¥
                try {
                    localStorage.setItem('crossword_words_backup_vanilla', JSON.stringify(words));
                    console.log('ë‹¨ì–´ ì‚­ì œë¨ ë° ë°±ì—… ì—…ë°ì´íŠ¸');
                } catch (error) {
                    console.error('ë°±ì—… ì €ì¥ ì‹¤íŒ¨:', error);
                }
            }
        }

        // ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // íŒŒì¼ í™•ì¥ì ê²€ì¦
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                alert('ì—‘ì…€ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // ì²« ë²ˆì§¸ ì‹œíŠ¸ ì„ íƒ
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // JSONìœ¼ë¡œ ë³€í™˜
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    console.log('ì—‘ì…€ ë°ì´í„°:', jsonData);
                    
                    // ë°ì´í„° ê²€ì¦ ë° ë³€í™˜
                    const newWordsFromExcel = [];
                    let headerRowIndex = -1;
                    
                    // í—¤ë” í–‰ ì°¾ê¸° ('ë‹¨ì–´', 'ì„¤ëª…' ì—´)
                    for (let i = 0; i < Math.min(5, jsonData.length); i++) {
                        const row = jsonData[i];
                        if (row && row.length >= 2) {
                            const col1 = String(row[0] || '').trim().toLowerCase();
                            const col2 = String(row[1] || '').trim().toLowerCase();
                            
                            if ((col1.includes('ë‹¨ì–´') || col1.includes('word')) && 
                                (col2.includes('ì„¤ëª…') || col2.includes('hint') || col2.includes('clue'))) {
                                headerRowIndex = i;
                                break;
                            }
                        }
                    }
                    
                    // í—¤ë”ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ê°€ì •
                    if (headerRowIndex === -1) {
                        headerRowIndex = 0;
                    }
                    
                    // ë°ì´í„° í–‰ ì²˜ë¦¬
                    for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row && row.length >= 2) {
                            const word = String(row[0] || '').trim();
                            const hint = String(row[1] || '').trim();
                            
                            if (word && hint) {
                                newWordsFromExcel.push({
                                    id: Date.now() + Math.random(),
                                    word: word.toUpperCase(),
                                    hint: hint,
                                    direction: 'horizontal',
                                    placed: false,
                                    startRow: 0,
                                    startCol: 0
                                });
                            }
                        }
                    }
                    
                    if (newWordsFromExcel.length === 0) {
                        alert('ë‹¨ì–´ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì²« ë²ˆì§¸ ì—´: ë‹¨ì–´, ë‘ ë²ˆì§¸ ì—´: ì„¤ëª…');
                        event.target.value = '';
                        return;
                    }
                    
                    // ê¸°ì¡´ ë‹¨ì–´ì™€ í•©ì¹˜ê¸°
                    words = [...words, ...newWordsFromExcel];
                    updateWordList();
                    updateStats();
                    
                    // ë°±ì—… ì €ì¥
                    try {
                        localStorage.setItem('crossword_words_backup_vanilla', JSON.stringify(words));
                    } catch (error) {
                        console.error('ë°±ì—… ì €ì¥ ì‹¤íŒ¨:', error);
                    }
                    
                    alert(`âœ… ${newWordsFromExcel.length}ê°œ ë‹¨ì–´ ì¶”ê°€ë¨!`);
                    
                } catch (error) {
                    console.error('ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜.\níŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
                
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                event.target.value = '';
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadExcelTemplate() {
            const data = [
                ['ë‹¨ì–´', 'ì„¤ëª…'],
                ['í•™êµ', 'í•™ìƒë“¤ì´ ê³µë¶€í•˜ëŠ” ê³³'],
                ['ì„ ìƒë‹˜', 'í•™ìƒë“¤ì„ ê°€ë¥´ì¹˜ëŠ” ë¶„'],
                ['ì±…', 'ê¸€ì´ ì í˜€ìˆëŠ” ê²ƒ'],
                ['ì—°í•„', 'ê¸€ì”¨ë¥¼ ì“°ëŠ” ë„êµ¬']
            ];

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'ë‹¨ì–´ëª©ë¡');

            // ì…€ ìŠ¤íƒ€ì¼ ì„¤ì • (í—¤ë” êµµê²Œ)
            if (worksheet['A1']) worksheet['A1'].s = { font: { bold: true } };
            if (worksheet['B1']) worksheet['B1'].s = { font: { bold: true } };

            XLSX.writeFile(workbook, 'ë‚±ë§í€´ì¦ˆ_í…œí”Œë¦¿.xlsx');
        }
        
        function toggleWordDirection(id) {
            const word = words.find(w => w.id === id);
            if (word) {
                word.direction = word.direction === 'horizontal' ? 'vertical' : 'horizontal';
                
                // ë°©í–¥ ë³€ê²½ í›„ ë°°ì¹˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                if (word.placed && !canPlaceWord(word, word.startRow, word.startCol)) {
                    word.placed = false;
                }
                
                regenerateGrid();
                updateWordList();
                updateStats();
            }
        }
        
        function selectWordForPlacement(id) {
            const word = words.find(w => w.id === id);
            if (word) {
                selectedWordForPlacement = word;
                updateWordList(); // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                
                // ëª¨ë°”ì¼ì—ì„œ ì‹œê°ì  ì•ˆë‚´ ì œê³µ
                if (window.innerWidth <= 768) {
                    showTouchFeedback(`"${word.word}" ì„ íƒë¨ - ê·¸ë¦¬ë“œì—ì„œ ë°°ì¹˜í•  ìœ„ì¹˜ë¥¼ í„°ì¹˜í•˜ì„¸ìš”`, 'info');
                    
                    // ê·¸ë¦¬ë“œ ì…€ë“¤ì— ë°°ì¹˜ ê°€ëŠ¥ íŒíŠ¸ ì¶”ê°€
                    document.querySelectorAll('.cell').forEach(cell => {
                        cell.style.boxShadow = '0 0 0 2px rgba(33, 150, 243, 0.3)';
                        cell.style.cursor = 'pointer';
                    });
                }
            }
        }
        
        // ========== ë°°ì¹˜ ì•Œê³ ë¦¬ì¦˜ ==========
        function canPlaceWord(word, startRow, startCol) {
            for (let i = 0; i < word.word.length; i++) {
                const row = word.direction === 'horizontal' ? startRow : startRow + i;
                const col = word.direction === 'horizontal' ? startCol + i : startCol;
                
                // ê·¸ë¦¬ë“œ ë²”ìœ„ í™•ì¸
                if (row < 0 || row >= gridSize.rows || col < 0 || col >= gridSize.cols) {
                    return false;
                }
                
                // ì¶©ëŒ í™•ì¸ (ê°™ì€ ê¸€ìëŠ” êµì°¨ì ìœ¼ë¡œ í—ˆìš©)
                const currentCell = grid[row][col];
                if (currentCell !== '' && currentCell !== word.word[i]) {
                    return false;
                }
            }
            return true;
        }

        // êµì°¨ì  ì°¾ê¸° í•¨ìˆ˜
        function findIntersections(word1, word2) {
            const intersections = [];
            
            for (let i = 0; i < word1.word.length; i++) {
                for (let j = 0; j < word2.word.length; j++) {
                    if (word1.word[i] === word2.word[j]) {
                        intersections.push({
                            word1Index: i,
                            word2Index: j,
                            letter: word1.word[i]
                        });
                    }
                }
            }
            
            return intersections;
        }

        // êµì°¨ì ì—ì„œ ë‹¨ì–´ ë°°ì¹˜ ì‹œë„
        function tryPlaceWordAtIntersection(newWord, placedWord, intersection) {
            const isNewHorizontal = newWord.direction === 'horizontal';
            const isPlacedHorizontal = placedWord.direction === 'horizontal';
            
            // ì„œë¡œ ë‹¤ë¥¸ ë°©í–¥ì¸ ê²½ìš°ì—ë§Œ êµì°¨ ê°€ëŠ¥
            if (isNewHorizontal === isPlacedHorizontal) return null;
            
            let newStartRow, newStartCol;
            
            if (isNewHorizontal) {
                // ìƒˆ ë‹¨ì–´ê°€ ê°€ë¡œ, ê¸°ì¡´ ë‹¨ì–´ê°€ ì„¸ë¡œ
                newStartRow = placedWord.startRow + intersection.word2Index;
                newStartCol = placedWord.startCol - intersection.word1Index;
            } else {
                // ìƒˆ ë‹¨ì–´ê°€ ì„¸ë¡œ, ê¸°ì¡´ ë‹¨ì–´ê°€ ê°€ë¡œ  
                newStartRow = placedWord.startRow - intersection.word1Index;
                newStartCol = placedWord.startCol + intersection.word2Index;
            }
            
            // ë²”ìœ„ í™•ì¸
            if (newStartRow < 0 || newStartCol < 0) return null;
            
            const maxRow = isNewHorizontal ? newStartRow + 1 : newStartRow + newWord.word.length;
            const maxCol = isNewHorizontal ? newStartCol + newWord.word.length : newStartCol + 1;
            
            if (maxRow > gridSize.rows || maxCol > gridSize.cols) return null;
            
            // ë°°ì¹˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            if (canPlaceWord(newWord, newStartRow, newStartCol)) {
                return { startRow: newStartRow, startCol: newStartCol };
            }
            
            return null;
        }
        
        function placeWordOnGrid(word) {
            for (let i = 0; i < word.word.length; i++) {
                const row = word.direction === 'horizontal' ? word.startRow : word.startRow + i;
                const col = word.direction === 'horizontal' ? word.startCol + i : word.startCol;
                grid[row][col] = word.word[i];
            }
        }
        
        function regenerateGrid() {
            grid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
            
            words.filter(word => word.placed).forEach(word => {
                placeWordOnGrid(word);
            });
            
            updateGridDisplay();
        }
        
        function autoPlaceWords() {
            // ëª¨ë“  ë‹¨ì–´ì˜ ë°°ì¹˜ ìƒíƒœ ì´ˆê¸°í™”
            words.forEach(word => word.placed = false);
            grid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
            
            if (words.length === 0) {
                alert('ë‹¨ì–´ë¥¼ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”!');
                return;
            }
            
            // ì²« ë²ˆì§¸ ë‹¨ì–´ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜
            const firstWord = words[0];
            const centerRow = Math.floor(gridSize.rows / 2);
            let centerCol;
            
            if (firstWord.direction === 'horizontal') {
                centerCol = Math.max(0, Math.floor(gridSize.cols / 2) - Math.floor(firstWord.word.length / 2));
            } else {
                centerCol = Math.floor(gridSize.cols / 2);
            }
            
            if (canPlaceWord(firstWord, centerRow, centerCol)) {
                firstWord.startRow = centerRow;
                firstWord.startCol = centerCol;
                firstWord.placed = true;
                placeWordOnGrid(firstWord);
            }

            // ë‚˜ë¨¸ì§€ ë‹¨ì–´ë“¤ì„ êµì°¨ì  ìš°ì„ ìœ¼ë¡œ ë°°ì¹˜
            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                let placed = false;
                let bestPosition = null;
                
                // 1. ë¨¼ì € ê¸°ì¡´ ë°°ì¹˜ëœ ë‹¨ì–´ë“¤ê³¼ì˜ êµì°¨ì  ì°¾ê¸°
                const placedWords = words.filter(w => w.placed);
                
                for (const placedWord of placedWords) {
                    const intersections = findIntersections(word, placedWord);
                    
                    for (const intersection of intersections) {
                        const position = tryPlaceWordAtIntersection(word, placedWord, intersection);
                        if (position) {
                            bestPosition = position;
                            placed = true;
                            break;
                        }
                    }
                    
                    if (placed) break;
                }
                
                // 2. êµì°¨ì  ë°°ì¹˜ê°€ ì•ˆ ë˜ë©´ ë¹ˆ ê³µê°„ì— ëœë¤ ë°°ì¹˜ ì‹œë„
                if (!placed) {
                    for (let attempt = 0; attempt < 100 && !placed; attempt++) {
                        const maxRow = word.direction === 'horizontal' ? gridSize.rows : gridSize.rows - word.word.length + 1;
                        const maxCol = word.direction === 'horizontal' ? gridSize.cols - word.word.length + 1 : gridSize.cols;
                        
                        if (maxRow <= 0 || maxCol <= 0) continue;
                        
                        const startRow = Math.floor(Math.random() * maxRow);
                        const startCol = Math.floor(Math.random() * maxCol);
                        
                        if (canPlaceWord(word, startRow, startCol)) {
                            bestPosition = { startRow, startCol };
                            placed = true;
                        }
                    }
                }
                
                // ë‹¨ì–´ ë°°ì¹˜
                if (placed && bestPosition) {
                    word.startRow = bestPosition.startRow;
                    word.startCol = bestPosition.startCol;
                    word.placed = true;
                    placeWordOnGrid(word);
                }
            }
            
            updateGridDisplay();
            updateWordList();
            updateStats();
            
            const placedCount = words.filter(w => w.placed).length;
            const intersectionCount = countIntersections();
            alert(`ğŸ¯ ìë™ ë°°ì¹˜ ì™„ë£Œ!\n${placedCount}/${words.length}ê°œ ë°°ì¹˜ë¨`);
        }
        
        // êµì°¨ì  ê°œìˆ˜ ê³„ì‚°
        function countIntersections() {
            let count = 0;
            const placedWords = words.filter(w => w.placed);
            
            for (let i = 0; i < placedWords.length; i++) {
                for (let j = i + 1; j < placedWords.length; j++) {
                    const intersections = findIntersections(placedWords[i], placedWords[j]);
                    
                    // ì‹¤ì œ êµì°¨í•˜ëŠ”ì§€ í™•ì¸
                    for (const intersection of intersections) {
                        const word1 = placedWords[i];
                        const word2 = placedWords[j];
                        
                        if (word1.direction !== word2.direction) {
                            const row1 = word1.direction === 'horizontal' ? word1.startRow : word1.startRow + intersection.word1Index;
                            const col1 = word1.direction === 'horizontal' ? word1.startCol + intersection.word1Index : word1.startCol;
                            
                            const row2 = word2.direction === 'horizontal' ? word2.startRow : word2.startRow + intersection.word2Index;
                            const col2 = word2.direction === 'horizontal' ? word2.startCol + intersection.word2Index : word2.startCol;
                            
                            if (row1 === row2 && col1 === col2) {
                                count++;
                                break; // ê°™ì€ ë‹¨ì–´ ìŒì—ì„œëŠ” í•˜ë‚˜ì˜ êµì°¨ì ë§Œ ì¹´ìš´íŠ¸
                            }
                        }
                    }
                }
            }
            
            return count;
        }
        
        function clearGrid() {
            if (confirm('ê·¸ë¦¬ë“œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë‹¨ì–´ ë°°ì¹˜ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                words.forEach(word => word.placed = false);
                grid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
                updateGridDisplay();
                updateWordList();
                updateStats();
            }
        }
        
        // ========== ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ëª¨ë°”ì¼ í„°ì¹˜ ì§€ì› ê°œì„ ) ==========
        let draggedWord = null;
        let isDragging = false;
        let touchStartPos = { x: 0, y: 0 };
        let dragPreview = null;
        
        function handleDragStart(e, row, col) {
            // í•´ë‹¹ ìœ„ì¹˜ì˜ ë‹¨ì–´ ì°¾ê¸°
            const wordAtPosition = words.find(word => {
                if (!word.placed) return false;
                const { startRow, startCol, direction, word: wordText } = word;
                
                for (let i = 0; i < wordText.length; i++) {
                    const wordRow = direction === 'horizontal' ? startRow : startRow + i;
                    const wordCol = direction === 'horizontal' ? startCol + i : startCol;
                    if (wordRow === row && wordCol === col) {
                        return true;
                    }
                }
                return false;
            });
            
            if (wordAtPosition) {
                draggedWord = wordAtPosition;
                if (e.dataTransfer) {
                    e.dataTransfer.effectAllowed = 'move';
                }
            }
        }
        
        // í„°ì¹˜ ë“œë˜ê·¸ ì‹œì‘ (ëª¨ë°”ì¼)
        function handleTouchStart(e, row, col) {
            // ë‹¨ì–´ ì„ íƒ ëª¨ë“œì¸ ê²½ìš° ë“œë˜ê·¸ ë°©ì§€
            if (selectedWordForPlacement) {
                return;
            }
            
            const touch = e.touches[0];
            touchStartPos = { x: touch.clientX, y: touch.clientY };
            
            // í•´ë‹¹ ìœ„ì¹˜ì˜ ë‹¨ì–´ ì°¾ê¸°
            const wordAtPosition = words.find(word => {
                if (!word.placed) return false;
                const { startRow, startCol, direction, word: wordText } = word;
                
                for (let i = 0; i < wordText.length; i++) {
                    const wordRow = direction === 'horizontal' ? startRow : startRow + i;
                    const wordCol = direction === 'horizontal' ? startCol + i : startCol;
                    if (wordRow === row && wordCol === col) {
                        return true;
                    }
                }
                return false;
            });
            
            if (wordAtPosition) {
                draggedWord = wordAtPosition;
                isDragging = false; // ì•„ì§ ë“œë˜ê·¸ ì‹œì‘í•˜ì§€ ì•ŠìŒ
                
                // ì‹œê°ì  í”¼ë“œë°± ì¶”ê°€
                e.currentTarget.style.transform = 'scale(1.05)';
                e.currentTarget.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                e.currentTarget.style.zIndex = '100';
            }
        }
        
        // í„°ì¹˜ ë“œë˜ê·¸ ì´ë™ (ëª¨ë°”ì¼)
        function handleTouchMove(e, currentRow, currentCol) {
            // ë‹¨ì–´ ì„ íƒ ëª¨ë“œì¸ ê²½ìš° ë“œë˜ê·¸ ë°©ì§€
            if (selectedWordForPlacement) {
                return;
            }
            
            if (!draggedWord) return;
            
            const touch = e.touches[0];
            const deltaX = Math.abs(touch.clientX - touchStartPos.x);
            const deltaY = Math.abs(touch.clientY - touchStartPos.y);
            
            // ì¼ì • ê±°ë¦¬ ì´ìƒ ì›€ì§ì—¬ì•¼ ë“œë˜ê·¸ ì‹œì‘
            if (!isDragging && (deltaX > 10 || deltaY > 10)) {
                isDragging = true;
                e.preventDefault(); // ë“œë˜ê·¸ ì‹œì‘ ì‹œì—ë§Œ ìŠ¤í¬ë¡¤ ë°©ì§€
                
                // ë“œë˜ê·¸ í”„ë¦¬ë·° ìƒì„±
                createDragPreview(draggedWord, touch.clientX, touch.clientY);
                
                // ì›ë³¸ ì…€ë“¤ ë°˜íˆ¬ëª… ì²˜ë¦¬
                highlightWordCells(draggedWord, 'dragging');
            }
            
            if (isDragging && dragPreview) {
                e.preventDefault(); // ë“œë˜ê·¸ ì¤‘ì¼ ë•ŒëŠ” ìŠ¤í¬ë¡¤ ë°©ì§€
                
                // ë“œë˜ê·¸ í”„ë¦¬ë·° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                dragPreview.style.left = (touch.clientX - 20) + 'px';
                dragPreview.style.top = (touch.clientY - 20) + 'px';
                
                // í˜„ì¬ í„°ì¹˜ ìœ„ì¹˜ ì•„ë˜ì˜ ì…€ í•˜ì´ë¼ì´íŠ¸
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                const targetCell = elementBelow?.closest('.cell');
                
                // ëª¨ë“  ì…€ì—ì„œ drop-target í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('drop-target');
                });
                
                // í˜„ì¬ ëŒ€ìƒ ì…€ì— í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€
                if (targetCell && targetCell.dataset.row !== undefined) {
                    const targetRow = parseInt(targetCell.dataset.row);
                    const targetCol = parseInt(targetCell.dataset.col);
                    
                    if (canPlaceWord(draggedWord, targetRow, targetCol)) {
                        targetCell.classList.add('drop-target');
                    }
                }
            }
        }
        
        // í„°ì¹˜ ë“œë˜ê·¸ ì¢…ë£Œ (ëª¨ë°”ì¼)
        function handleTouchEnd(e, currentRow, currentCol) {
            // ë‹¨ì–´ ì„ íƒ ëª¨ë“œì¸ ê²½ìš° ë°°ì¹˜ ê¸°ëŠ¥ ì‹¤í–‰
            if (selectedWordForPlacement) {
                e.preventDefault();
                handleCellClick(currentRow, currentCol);
                return;
            }
            
            if (!draggedWord) return;
            
            const touch = e.changedTouches[0];
            
            // ë“œë˜ê·¸ê°€ ì‹œì‘ë˜ì—ˆë‹¤ë©´ ë“œë¡­ ì²˜ë¦¬
            if (isDragging) {
                e.preventDefault(); // ë“œë˜ê·¸ ì™„ë£Œ ì‹œì—ë§Œ ê¸°ë³¸ ë™ì‘ ë°©ì§€
                
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                const targetCell = elementBelow?.closest('.cell');
                
                if (targetCell && targetCell.dataset.row !== undefined) {
                    const targetRow = parseInt(targetCell.dataset.row);
                    const targetCol = parseInt(targetCell.dataset.col);
                    
                    if (canPlaceWord(draggedWord, targetRow, targetCol)) {
                        // ì„±ê³µì ìœ¼ë¡œ ë“œë¡­
                        draggedWord.startRow = targetRow;
                        draggedWord.startCol = targetCol;
                        draggedWord.placed = true;
                        regenerateGrid();
                        updateWordList();
                        updateStats();
                    } else {
                        // ë“œë¡­ ì‹¤íŒ¨ í”¼ë“œë°±
                        showTouchFeedback('âŒ ì—¬ê¸°ì— ë°°ì¹˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                    }
                } else {
                    showTouchFeedback('âŒ ê·¸ë¦¬ë“œ ì˜ì—­ì— ë“œë¡­í•˜ì„¸ìš”', 'error');
                }
                
                // ë“œë˜ê·¸ í”„ë¦¬ë·° ì œê±°
                if (dragPreview) {
                    dragPreview.remove();
                    dragPreview = null;
                }
                
                // í•˜ì´ë¼ì´íŠ¸ ì œê±° ë° ëª¨ë“  ë“œë˜ê·¸ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì •ë¦¬
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('drop-target');
                    // ë“œë˜ê·¸ ì¤‘ì— ì¶”ê°€ëœ ëª¨ë“  ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°
                    cell.style.transform = '';
                    cell.style.boxShadow = '';
                    cell.style.zIndex = '';
                    cell.style.opacity = '';
                    cell.style.background = '';
                });
                highlightWordCells(draggedWord, 'normal');
            } else {
                // ë“œë˜ê·¸ê°€ ì‹œì‘ë˜ì§€ ì•Šì•˜ë‹¤ë©´ í´ë¦­ìœ¼ë¡œ ì²˜ë¦¬ (ìŠ¤í¬ë¡¤ì€ í—ˆìš©)
                const targetCell = e.currentTarget;
                targetCell.style.transform = '';
                targetCell.style.boxShadow = '';
                targetCell.style.zIndex = '';
                targetCell.style.opacity = '';
                targetCell.style.background = '';
            }
            
            // ìƒíƒœ ì´ˆê¸°í™”
            draggedWord = null;
            isDragging = false;
            touchStartPos = { x: 0, y: 0 };
            
            // ê·¸ë¦¬ë“œ ë””ìŠ¤í”Œë ˆì´ ê°•ì œ ì—…ë°ì´íŠ¸ë¡œ ì›ë˜ ëª¨ìŠµ ë³µì›
            setTimeout(() => {
                updateGridDisplay();
            }, 100);
        }
        
        // ë“œë˜ê·¸ í”„ë¦¬ë·° ìƒì„±
        function createDragPreview(word, x, y) {
            dragPreview = document.createElement('div');
            dragPreview.style.cssText = `
                position: fixed;
                left: ${x - 20}px;
                top: ${y - 20}px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 8px 12px;
                border-radius: 8px;
                font-weight: bold;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                pointer-events: none;
                transform: rotate(-3deg);
                animation: dragBounce 0.3s ease;
            `;
            dragPreview.textContent = word.word;
            document.body.appendChild(dragPreview);
        }
        
        // ë‹¨ì–´ ì…€ë“¤ í•˜ì´ë¼ì´íŠ¸
        function highlightWordCells(word, state) {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                // í•´ë‹¹ ë‹¨ì–´ì— ì†í•˜ëŠ” ì…€ì¸ì§€ í™•ì¸
                let belongsToWord = false;
                for (let i = 0; i < word.word.length; i++) {
                    const wordRow = word.direction === 'horizontal' ? word.startRow : word.startRow + i;
                    const wordCol = word.direction === 'horizontal' ? word.startCol + i : word.startCol;
                    if (wordRow === row && wordCol === col) {
                        belongsToWord = true;
                        break;
                    }
                }
                
                if (belongsToWord) {
                    if (state === 'dragging') {
                        cell.style.opacity = '0.5';
                        cell.style.background = '#e3f2fd';
                    } else {
                        // ìŠ¤íƒ€ì¼ ì™„ì „íˆ ì œê±°í•˜ê³  ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸ë¡œ ì›ë˜ ìƒíƒœ ë³µì›
                        cell.style.opacity = '';
                        cell.style.background = '';
                        cell.style.transform = '';
                        cell.style.boxShadow = '';
                        cell.style.zIndex = '';
                    }
                }
            });
            
            // normal ìƒíƒœì¼ ë•Œ ê·¸ë¦¬ë“œ ë””ìŠ¤í”Œë ˆì´ ê°•ì œ ì—…ë°ì´íŠ¸
            if (state === 'normal') {
                setTimeout(() => {
                    updateGridDisplay();
                }, 50);
            }
        }
        
        // í„°ì¹˜ í”¼ë“œë°± í‘œì‹œ
        function showTouchFeedback(message, type) {
            const feedback = document.createElement('div');
            
            let backgroundColor;
            let duration = 1500;
            
            switch(type) {
                case 'success':
                    backgroundColor = '#4CAF50';
                    break;
                case 'error':
                    backgroundColor = '#f44336';
                    break;
                case 'info':
                    backgroundColor = '#2196F3';
                    duration = 2000; // infoëŠ” ì¡°ê¸ˆ ë” ê¸¸ê²Œ í‘œì‹œ
                    break;
                default:
                    backgroundColor = '#666';
            }
            
            feedback.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${backgroundColor};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: bold;
                z-index: 2000;
                animation: feedbackPop ${duration}ms ease forwards;
                max-width: 280px;
                text-align: center;
                font-size: 14px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.remove();
                }
            }, duration);
        }
        
        function handleDrop(e, row, col) {
            e.preventDefault();
            if (draggedWord) {
                if (canPlaceWord(draggedWord, row, col)) {
                    draggedWord.startRow = row;
                    draggedWord.startCol = col;
                    draggedWord.placed = true;
                    regenerateGrid();
                    updateWordList();
                    updateStats();
                }
                draggedWord = null;
            }
        }
        
        function handleDragOver(e) {
            e.preventDefault();
        }
        
        function handleCellClick(row, col) {
            if (selectedWordForPlacement) {
                if (canPlaceWord(selectedWordForPlacement, row, col)) {
                    // ê¸°ì¡´ ë°°ì¹˜ ì œê±°
                    if (selectedWordForPlacement.placed) {
                        regenerateGrid();
                    }
                    
                    selectedWordForPlacement.startRow = row;
                    selectedWordForPlacement.startCol = col;
                    selectedWordForPlacement.placed = true;
                    
                    regenerateGrid();
                    updateWordList();
                    updateStats();
                    
                    selectedWordForPlacement = null;
                    
                    // ëª¨ë°”ì¼ì—ì„œ ì‹œê°ì  íŒíŠ¸ ì œê±°
                    if (window.innerWidth <= 768) {
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.style.boxShadow = '';
                            cell.style.cursor = '';
                        });
                    }
                } else {
                    // ëª¨ë°”ì¼ì—ì„œëŠ” í„°ì¹˜ í”¼ë“œë°±ìœ¼ë¡œ í‘œì‹œ
                    if (window.innerWidth <= 768) {
                        showTouchFeedback('âŒ ì´ ìœ„ì¹˜ì— ë°°ì¹˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
                    } else {
                        alert('ì´ ìœ„ì¹˜ì— ë°°ì¹˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    }
                }
            }
        }
        
        // ========== UI ì—…ë°ì´íŠ¸ ==========
        function updateWordList() {
            console.log('updateWordList í˜¸ì¶œë¨, words ë°°ì—´:', words.length, 'ê°œ'); // ë””ë²„ê·¸ ë¡œê·¸
            const wordList = document.getElementById('wordList');
            if (!wordList) {
                console.log('wordList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ'); // ë””ë²„ê·¸ ë¡œê·¸
                // ë‹¤ì‹œ ì‹œë„
                setTimeout(() => {
                    console.log('wordList ìš”ì†Œ ì¬ì‹œë„');
                    updateWordList();
                }, 100);
                return;
            }
            
            console.log('ë‹¨ì–´ ëª©ë¡ ìƒì„¸:', words.map(w => `${w.word}(${w.placed ? 'ë°°ì¹˜ë¨' : 'ë¯¸ë°°ì¹˜'})`)); // ë””ë²„ê·¸ ë¡œê·¸
            console.log('ë¯¸ë°°ì¹˜ëœ ë‹¨ì–´ ìˆ˜:', words.filter(w => !w.placed).length); // ë””ë²„ê·¸ ë¡œê·¸
            
            // ì•ˆì „í•˜ê²Œ innerHTML ì´ˆê¸°í™”
            try {
                wordList.innerHTML = '';
            } catch (error) {
                console.error('wordList innerHTML ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                return;
            }
            
            if (words.length === 0) {
                wordList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">ë“±ë¡ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = `word-item ${word.placed ? '' : 'unplaced'}`;
                
                if (selectedWordForPlacement && selectedWordForPlacement.id === word.id) {
                    wordItem.className += ' selected';
                }
                
                wordItem.style.position = 'relative';
                wordItem.style.paddingRight = '30px';
                
                wordItem.innerHTML = `
                    <button onclick="deleteWord(${word.id})" style="position: absolute; top: 8px; right: 8px; width: 20px; height: 20px; background: #ff5252; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center;">âœ•</button>
                    
                    <div class="word-text">${word.word}</div>
                    <div class="word-hint">${word.hint}</div>
                    <div class="word-meta">
                        <span>${word.direction === 'horizontal' ? 'â¡ï¸ ê°€ë¡œ' : 'â¬‡ï¸ ì„¸ë¡œ'} ${word.placed ? 'âœ… ë°°ì¹˜ë¨' : 'âŒ ë¯¸ë°°ì¹˜'}</span>
                        <div style="margin-top: 8px;">
                            <button class="btn btn-secondary" style="padding: 4px 12px; margin: 2px; font-size: 11px;" onclick="selectWordForPlacement(${word.id})">ì„ íƒ</button>
                            <button class="btn btn-primary" style="padding: 4px 12px; margin: 2px; font-size: 11px;" onclick="toggleWordDirection(${word.id})">ë°©í–¥ ì „í™˜</button>
                        </div>
                    </div>
                `;
                

                
                wordList.appendChild(wordItem);
                console.log(`ë‹¨ì–´ DOM ì¶”ê°€ë¨: ${word.word} (${word.placed ? 'ë°°ì¹˜ë¨' : 'ë¯¸ë°°ì¹˜'})`);
            });
            
            console.log('updateWordList ì™„ë£Œ, DOMì— ì¶”ê°€ëœ ë‹¨ì–´ ìˆ˜:', wordList.children.length);
            
            // ìµœì¢… ê²€ì¦
            const unplacedCount = words.filter(w => !w.placed).length;
            const unplacedInDOM = wordList.querySelectorAll('.word-item').length;
            if (unplacedCount > 0 && unplacedInDOM === 0) {
                console.error('âš ï¸ ë¯¸ë°°ì¹˜ ë‹¨ì–´ê°€ DOMì— í‘œì‹œë˜ì§€ ì•ŠìŒ! ê°•ì œ ì¬ì‹œë„');
                setTimeout(() => updateWordList(), 200);
            }
        }
        
        function updateStats() {
            // DOM ìš”ì†Œ ì¡´ì¬ í™•ì¸ í›„ ì—…ë°ì´íŠ¸ (í’€ì´ ëª¨ë“œì—ì„œëŠ” ì´ ìš”ì†Œë“¤ì´ ì—†ìŒ)
            const totalWordsEl = document.getElementById('totalWords');
            const placedWordsEl = document.getElementById('placedWords');
            const gridSizeEl = document.getElementById('gridSize');
            
            if (totalWordsEl) totalWordsEl.textContent = words.length;
            if (placedWordsEl) placedWordsEl.textContent = words.filter(w => w.placed).length;
            if (gridSizeEl) gridSizeEl.textContent = `${gridSize.cols}Ã—${gridSize.rows}`;
        }
        
        // ========== ê³µìœ  ë° ê¸°íƒ€ ê¸°ëŠ¥ ==========



        function loadQuizFromCode() {
            const codeInput = document.getElementById('codeInput');
            const code = codeInput.value.trim().toUpperCase();
            
            if (!code) {
                alert('í€´ì¦ˆ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            const loadingAlert = document.createElement('div');
            loadingAlert.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 2000; text-align: center; min-width: 200px;
            `;
            loadingAlert.innerHTML = `
                                        <div style="color: #2196F3; font-weight: bold; margin-bottom: 10px;">ğŸ” í€´ì¦ˆ ê²€ìƒ‰ ì¤‘...</div>
                <div style="color: #666; font-size: 14px;">í€´ì¦ˆ ì½”ë“œ: ${code}</div>
            `;
            document.body.appendChild(loadingAlert);
            
            // Supabaseì—ì„œ í€´ì¦ˆ ë¡œë“œ
            (async () => {
                try {
                    // Supabaseì—ì„œ í€´ì¦ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const loadedQuizData = await loadQuizFromSupabase(code);
                    
                    // ë¡œë”©ì°½ ì œê±°
                    if (loadingAlert.parentNode) {
                        document.body.removeChild(loadingAlert);
                    }
                    
                    // ğŸ”’ ê³µìœ ë°›ì€ í€´ì¦ˆ ìƒíƒœë¡œ ì„¤ì •
                    isSharedQuizMode = true;
                    sharedQuizData = { ...loadedQuizData };
                    
                    quizData = loadedQuizData;
                    words = loadedQuizData.words || [];
                    grid = loadedQuizData.grid || [];
                    gridSize = loadedQuizData.gridSize || { rows: 10, cols: 10 };
                    
                    // playerGrid ì´ˆê¸°í™”
                    playerGrid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
                    
                    // ë‹¨ì–´ ë²ˆí˜¸ ìƒì„±
                    wordNumbers = generateWordNumbers(words);
                    completedWords = new Set();
                    missionCompleted = false;
                    
                    switchMode('solve');
                    
                    setTimeout(() => {
                        alert(`ğŸ® "${loadedQuizData.title}" ë¡œë“œ ì™„ë£Œ!\nì¦ê±°ìš´ í€´ì¦ˆ ì‹œê°„ ë˜ì„¸ìš”! ğŸ§©`);
                    }, 300);
                    
                } catch (error) {
                    // ë¡œë”©ì°½ ì œê±°
                    if (loadingAlert.parentNode) {
                        document.body.removeChild(loadingAlert);
                    }
                    
                    console.error('í€´ì¦ˆ ë¡œë”© ì˜¤ë¥˜:', error);
                    
                    // ì‚¬ìš©ì ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
                    let errorMessage = 'âŒ í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n';
                    
                    if (error.message && error.message.includes('Failed to fetch')) {
                        errorMessage += 'ğŸŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message && error.message.includes('í€´ì¦ˆ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')) {
                        errorMessage += 'ğŸ“ í€´ì¦ˆ ì½”ë“œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (error.message && error.message.includes('í€´ì¦ˆ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤')) {
                        errorMessage += 'ğŸ“„ í€´ì¦ˆ ë°ì´í„°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\ní€´ì¦ˆ ì œì‘ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                    } else if (error.message && error.message.includes('ì´ˆê¸°í™”')) {
                        errorMessage += 'ğŸ”§ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else {
                        errorMessage += 'ğŸ”„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                    
                    alert(errorMessage);
                }
            })();
        }


        
        function showSolveMode() {
            const quizTitle = sharedQuizData?.title || 'ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ';
            const horizontalWords = words.filter(w => w.direction === 'horizontal' && w.placed);
            const verticalWords = words.filter(w => w.direction === 'vertical' && w.placed);
            
            document.querySelector('.container').innerHTML = `
                <div class="header">
                    <h1>ğŸ§© ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°</h1>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmSwitchToCreate()" class="mode-badge" style="cursor: pointer; border: none; font-size: 1rem; opacity: 0.7; background: linear-gradient(45deg, #4CAF50, #45a049);">
                            ğŸ“ ì œì‘ ëª¨ë“œ
                        </button>
                        <button class="mode-badge" style="cursor: pointer; border: none; background: linear-gradient(45deg, #2196F3, #1976D2); font-size: 1rem; opacity: 1;">
                            ğŸ® í’€ì´ ëª¨ë“œ
                        </button>
                    </div>
                </div>
                
                ${missionCompleted ? `
                    <div style="background: linear-gradient(45deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; text-align: center; animation: slideDown 0.5s ease;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‰</div>
                        <h2 style="margin: 0 0 10px 0;">ë¯¸ì…˜ ì„±ê³µ!</h2>
                        <p style="margin: 0;">ëª¨ë“  í€´ì¦ˆë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤! ì •ë§ ë©‹ì ¸ìš”!</p>
                    </div>
                ` : ''}
                
                ${quizTitle ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <span style="background: #e3f2fd; color: #1976d2; padding: 8px 20px; border-radius: 25px; font-size: 14px; font-weight: 500;">
                            ğŸ“ ${quizTitle}
                        </span>
                    </div>
                ` : ''}
                
                <div class="solve-layout">
                    <div class="solve-grid-container" id="gridContainer">
                        <h3 style="margin-bottom: clamp(18px, 2.8vw, 22px); color: #333; font-size: clamp(16px, 3.2vw, 19px); text-align: center; font-weight: 700;">ğŸ¯ í€´ì¦ˆ ê·¸ë¦¬ë“œ</h3>
                        <div class="solve-grid" id="solveGrid" style="grid-template-columns: repeat(${gridSize.cols}, 1fr);">
                            <!-- ê·¸ë¦¬ë“œê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                        <div class="solve-grid-actions">
                            <button onclick="resetPlayerGrid()" style="padding: clamp(8px, 2vw, 12px) clamp(16px, 3vw, 20px); background: #f44336; color: white; border: none; border-radius: clamp(6px, 1vw, 8px); cursor: pointer; font-weight: bold; font-size: clamp(12px, 2.5vw, 14px);">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
                        </div>
                        <div class="solve-grid-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #c8e6c9; border-color: #4caf50;"></div>
                                <span>ì •ë‹µ</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ffcdd2; border-color: #f44336;"></div>
                                <span>ì˜¤ë‹µ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="word-clues-section">
                        <h3 style="margin-bottom: clamp(18px, 2.8vw, 22px); color: #333; font-size: clamp(16px, 3.2vw, 19px); text-align: center; font-weight: 700;">ğŸ“ ë‹¨ì–´ ì„¤ëª…</h3>
                        
                        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                        <div class="clues-tabs">
                            <button class="clues-tab active" onclick="switchCluesTab('horizontal')" id="horizontalTab">
                                <span class="clues-tab-icon">â¡ï¸</span>
                                <span>ê°€ë¡œ ë‹¨ì–´ (${horizontalWords.length}ê°œ)</span>
                            </button>
                            <button class="clues-tab" onclick="switchCluesTab('vertical')" id="verticalTab">
                                <span class="clues-tab-icon">â¬‡ï¸</span>
                                <span>ì„¸ë¡œ ë‹¨ì–´ (${verticalWords.length}ê°œ)</span>
                            </button>
                        </div>
                        
                        <!-- ê°€ë¡œ ë‹¨ì–´ íƒ­ ì½˜í…ì¸  -->
                        <div class="clues-tab-content active" id="horizontalContent">
                            <div id="horizontalClues">
                                ${horizontalWords
                                    .map(word => ({ ...word, number: wordNumbers[word.id]?.number || 999 }))
                                    .sort((a, b) => a.number - b.number)
                                    .map((word) => {
                                    const isCompleted = completedWords.has(word.id);
                                    const wordNum = word.number === 999 ? '?' : word.number;
                                    return `
                                        <div class="word-clue-item" style="background: ${isCompleted ? '#c8e6c9' : 'white'}; border-left-color: ${isCompleted ? '#4caf50' : '#ddd'};">
                                            <span class="word-clue-number" style="color: #2196F3;">${wordNum}.</span>
                                            <span class="word-clue-text" style="${isCompleted ? 'text-decoration: line-through; color: #4caf50;' : ''}">${word.hint || 'ì„¤ëª… ì—†ìŒ'}</span>
                                            ${isCompleted ? '<span class="word-clue-check" style="color: #4caf50;">âœ“</span>' : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- ì„¸ë¡œ ë‹¨ì–´ íƒ­ ì½˜í…ì¸  -->
                        <div class="clues-tab-content" id="verticalContent">
                            <div id="verticalClues">
                                ${verticalWords
                                    .map(word => ({ ...word, number: wordNumbers[word.id]?.number || 999 }))
                                    .sort((a, b) => a.number - b.number)
                                    .map((word) => {
                                    const isCompleted = completedWords.has(word.id);
                                    const wordNum = word.number === 999 ? '?' : word.number;
                                    return `
                                        <div class="word-clue-item" style="background: ${isCompleted ? '#c8e6c9' : 'white'}; border-left-color: ${isCompleted ? '#4caf50' : '#ddd'};">
                                            <span class="word-clue-number" style="color: #f44336;">${wordNum}.</span>
                                            <span class="word-clue-text" style="${isCompleted ? 'text-decoration: line-through; color: #4caf50;' : ''}">${word.hint || 'ì„¤ëª… ì—†ìŒ'}</span>
                                            ${isCompleted ? '<span class="word-clue-check" style="color: #4caf50;">âœ“</span>' : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                        
                        <div style="background: #e3f2fd; padding: clamp(12px, 2vw, 15px); border-radius: clamp(8px, 1.5vw, 10px); margin-top: auto; margin-bottom: 0; border: 1px solid #bbdefb; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.1); flex-shrink: 0;">
                            <p style="color: #1976d2; font-size: clamp(12px, 2.2vw, 14px); font-weight: bold; text-align: center; margin: 0; line-height: 1.3;">
                                ì§„í–‰ ìƒí™©: ${completedWords.size}/${words.filter(w => w.placed).length} ë‹¨ì–´ ì™„ì„±
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            createSolveGrid();
            
            // ì™„ì „ ë°˜ì‘í˜• ê·¸ë¦¬ë“œ í¬ê¸° ì¡°ì ˆ (ì¦‰ì‹œ ì‹¤í–‰ + ì§€ì—° ì‹¤í–‰)
            adjustGridContainerSize(); // ì¦‰ì‹œ ì‹¤í–‰
            setTimeout(() => {
                adjustGridContainerSize(); // ë Œë”ë§ ì™„ë£Œ í›„ ì¬ì¡°ì •
            }, 100);
        }
        
        // ì™„ì „ ë°˜ì‘í˜• ê·¸ë¦¬ë“œ í¬ê¸° ì¡°ì • í•¨ìˆ˜
        function adjustGridContainerSize() {
            const gridElement = document.getElementById('solveGrid');
            const containerElement = document.getElementById('gridContainer');
            
            if (!gridElement || !containerElement) return;
            
            // ê·¸ë¦¬ë“œ í¬ê¸° ì •ë³´
            const cols = gridSize.cols;
            const rows = gridSize.rows;
            const totalCells = cols * rows;
            
            // í™”ë©´ í¬ê¸° ì •ë³´
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const isMobile = viewportWidth <= 768;
            const isSmallMobile = viewportWidth <= 480;
            
            // ë™ì  ì…€ í¬ê¸° ê³„ì‚°
            let availableWidth;
            if (isMobile) {
                // ëª¨ë°”ì¼: ì•ˆì „í•œ ì—¬ë°±ì„ ê³ ë ¤í•œ ìµœëŒ€ ì‚¬ìš© ê°€ëŠ¥ í­
                if (isSmallMobile) {
                    availableWidth = viewportWidth * 0.85; // ì‘ì€ ëª¨ë°”ì¼: 85%
                } else {
                    availableWidth = viewportWidth * 0.88; // ì¼ë°˜ ëª¨ë°”ì¼: 88%
                }
            } else {
                // ë°ìŠ¤í¬í†±: ê·¸ë¦¬ë“œ í¬ê¸°ì— ë”°ë¥¸ ë™ì  ì»¨í…Œì´ë„ˆ ë„ˆë¹„ ê³„ì‚°
                const gridSizeFactor = Math.max(cols, rows) / 15; // ìµœëŒ€ ì°¨ì› ê¸°ì¤€ íŒ©í„°
                const cellCountFactor = totalCells / 225; // ì´ ì…€ ìˆ˜ ê¸°ì¤€ íŒ©í„° (15x15 = 225 ê¸°ì¤€)
                
                // ê¸°ë³¸ ë„ˆë¹„ì— ê·¸ë¦¬ë“œ í¬ê¸° íŒ©í„° ì ìš©
                const baseWidth = 580;
                const dynamicWidth = baseWidth + (gridSizeFactor * 120) + (cellCountFactor * 80);
                
                // ë·°í¬íŠ¸ í¬ê¸°ì— ë”°ë¥¸ ì•ˆì „ ì œí•œ (ë‹¤ë¥¸ ì˜ì—­ ì¹¨ë²” ë°©ì§€)
                const maxSafeWidth = Math.max(580, Math.min(800, viewportWidth * 0.55));
                availableWidth = Math.min(dynamicWidth, maxSafeWidth);
                
                console.log(`ğŸ”§ ë™ì  ë„ˆë¹„ ê³„ì‚°: ê·¸ë¦¬ë“œ${cols}Ã—${rows}, ê¸°ë³¸${baseWidth}px â†’ ë™ì ${Math.round(dynamicWidth)}px â†’ ìµœì¢…${Math.round(availableWidth)}px`);
            }
            
            // íŒ¨ë”©ê³¼ ì—¬ë°±ì„ ê³ ë ¤í•œ ì‹¤ì œ ê·¸ë¦¬ë“œ ì‚¬ìš© ê°€ëŠ¥ í­
            const padding = isSmallMobile ? 50 : (isMobile ? 70 : 80);
            const netGridWidth = Math.max(200, availableWidth - padding); // ìµœì†Œ 200px ë³´ì¥
            
            // ì…€ í¬ê¸° ê³„ì‚° (ìµœì†Œ/ìµœëŒ€ ì œí•œ ì ìš©)
            const minCellSize = isSmallMobile ? 16 : (isMobile ? 20 : 25);
            const maxCellSize = isSmallMobile ? 28 : (isMobile ? 35 : 45);
            
            // ìµœì  ì…€ í¬ê¸° = ì‚¬ìš© ê°€ëŠ¥ í­ / ë” í° ì°¨ì›(í–‰ ë˜ëŠ” ì—´)
            const maxDimension = Math.max(cols, rows);
            const gapSize = isSmallMobile ? 1 : (isMobile ? 2 : 3);
            const totalGaps = (maxDimension - 1) * gapSize;
            const targetCellSize = (netGridWidth - totalGaps) / maxDimension;
            
            // ìµœì¢… ì…€ í¬ê¸° (ì œí•œ ë²”ìœ„ ë‚´ì—ì„œ)
            const cellSize = Math.max(minCellSize, Math.min(maxCellSize, targetCellSize));
            
            // í°íŠ¸ í¬ê¸° ë¹„ë¡€ ê³„ì‚°
            const baseFontRatio = isSmallMobile ? 0.4 : (isMobile ? 0.45 : 0.5);
            const cellFontSize = Math.max(8, cellSize * baseFontRatio);
            
            // ê·¸ë¦¬ë“œ í¬ê¸°ì— ë”°ë¥¸ ìˆ«ì í°íŠ¸ í¬ê¸° ë™ì  ì¡°ì •
            let numberRatio;
            if (totalCells > 400) {
                numberRatio = 0.12; // ë§¤ìš° í° ê·¸ë¦¬ë“œ: 12%
            } else if (totalCells > 200) {
                numberRatio = 0.15; // í° ê·¸ë¦¬ë“œ: 15%
            } else if (totalCells > 100) {
                numberRatio = 0.18; // ì¤‘ê°„ ê·¸ë¦¬ë“œ: 18%
            } else {
                numberRatio = 0.22; // ì‘ì€ ê·¸ë¦¬ë“œ: 22%
            }
            
            // ëª¨ë°”ì¼ì—ì„œëŠ” ë” ì‘ê²Œ ì¡°ì •
            if (isSmallMobile) {
                numberRatio *= 0.8;
            } else if (isMobile) {
                numberRatio *= 0.9;
            }
            
            const numberFontSize = Math.max(4, cellSize * numberRatio);
            
            // ìˆ«ì ë¼ë²¨ íŒ¨ë”©ê³¼ í¬ê¸° ê³„ì‚° (ê·¸ë¦¬ë“œ í¬ê¸°ì— ë°˜ë¹„ë¡€)
            const labelPadding = Math.max(1, Math.min(3, cellSize * 0.08));
            const labelMinWidth = Math.max(6, Math.min(12, cellSize * 0.3));
            const labelBorderRadius = Math.max(1, Math.min(3, cellSize * 0.1));
            const labelOffset = Math.max(8, Math.min(14, labelMinWidth + labelPadding + 2));
            
            // CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸
            const root = document.documentElement;
            root.style.setProperty('--cell-size', `${cellSize}px`);
            root.style.setProperty('--cell-font-size', `${cellFontSize}px`);
            root.style.setProperty('--cell-number-size', `${numberFontSize}px`);
            root.style.setProperty('--label-padding', `${labelPadding}px`);
            root.style.setProperty('--label-min-width', `${labelMinWidth}px`);
            root.style.setProperty('--label-border-radius', `${labelBorderRadius}px`);
            root.style.setProperty('--label-offset', `${labelOffset}px`);
            
            // ë‹¨ì–´ ì„¤ëª… ì˜ì—­ ë†’ì´ ë™ì  ì¡°ì •
            const cluesMaxHeight = Math.min(
                viewportHeight * (isMobile ? 0.6 : 0.7),
                isMobile ? 450 : 600
            );
            const cluesScrollHeight = cluesMaxHeight - (isMobile ? 100 : 120);
            
            root.style.setProperty('--clues-max-height', `${cluesMaxHeight}px`);
            root.style.setProperty('--clues-scroll-height', `${cluesScrollHeight}px`);
            
            // ë™ì  ì»¨í…Œì´ë„ˆ í¬ê¸° CSS ë³€ìˆ˜ ì—…ë°ì´íŠ¸ (ë°ìŠ¤í¬í†±ë§Œ)
            if (!isMobile) {
                const dynamicGridMaxWidth = Math.round(availableWidth);
                const cluesWidth = 420; // ë‹¨ì–´ ì„¤ëª… ì˜ì—­ ê³ ì • ë„ˆë¹„
                const layoutGap = 25; // ë ˆì´ì•„ì›ƒ ê°„ê²©
                const layoutPadding = 30; // ì „ì²´ íŒ¨ë”©
                const dynamicLayoutMaxWidth = dynamicGridMaxWidth + cluesWidth + layoutGap + layoutPadding;
                
                root.style.setProperty('--dynamic-grid-max-width', `${dynamicGridMaxWidth}px`);
                root.style.setProperty('--layout-max-width', `${dynamicLayoutMaxWidth}px`);
                root.style.setProperty('--grid-container-width', `minmax(400px, ${dynamicGridMaxWidth}px)`);
                
                console.log(`ğŸ“ ë™ì  ë ˆì´ì•„ì›ƒ: ê·¸ë¦¬ë“œ${dynamicGridMaxWidth}px + ì„¤ëª…${cluesWidth}px = ì „ì²´${dynamicLayoutMaxWidth}px`);
            } else {
                // ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ë³¸ê°’ ìœ ì§€
                root.style.setProperty('--dynamic-grid-max-width', '580px');
                root.style.setProperty('--layout-max-width', '1050px');
                root.style.setProperty('--grid-container-width', 'minmax(300px, 580px)');
            }
            
            // ê·¸ë¦¬ë“œ gap ì¡°ì •
            gridElement.style.gap = `${gapSize}px`;
            
            console.log(`ğŸ¯ ë°˜ì‘í˜• ê·¸ë¦¬ë“œ ì¡°ì •: ${cols}Ã—${rows} (${totalCells}ì¹¸), ì…€:${cellSize}px, í°íŠ¸:${cellFontSize}px, ìˆ«ì:${numberFontSize}px, í™”ë©´:${viewportWidth}Ã—${viewportHeight}`);
        }
        
        // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ê·¸ë¦¬ë“œ í¬ê¸° ì¬ì¡°ì ˆ (ì™„ì „ ë°˜ì‘í˜•)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            if (mode === 'solve') {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    adjustGridContainerSize();
                }, 200); // ë” ë¹ ë¥¸ ë°˜ì‘
            }
        });
        
        // í™”ë©´ ë°©í–¥ ë³€ê²½ ê°ì§€ (ëª¨ë°”ì¼ ëŒ€ì‘)
        window.addEventListener('orientationchange', () => {
            if (mode === 'solve') {
                setTimeout(() => {
                    adjustGridContainerSize();
                }, 500); // ë°©í–¥ ì „í™˜ ì™„ë£Œ í›„ ì‹¤í–‰
            }
        });
        
        // ë‹¨ì–´ ì„¤ëª… íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchCluesTab(tabType) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.clues-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.clues-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tabType === 'horizontal') {
                document.getElementById('horizontalTab').classList.add('active');
                document.getElementById('horizontalContent').classList.add('active');
            } else if (tabType === 'vertical') {
                document.getElementById('verticalTab').classList.add('active');
                document.getElementById('verticalContent').classList.add('active');
            }
            
            console.log(`ğŸ“ ë‹¨ì–´ ì„¤ëª… íƒ­ ì „í™˜: ${tabType === 'horizontal' ? 'ê°€ë¡œ' : 'ì„¸ë¡œ'} ë‹¨ì–´`);
        }

        function createSolveGrid() {
            const gridElement = document.getElementById('solveGrid');
            gridElement.innerHTML = '';
            
            for (let row = 0; row < gridSize.rows; row++) {
                for (let col = 0; col < gridSize.cols; col++) {
                    const cell = document.createElement('div');
                    const letter = grid[row][col];
                    
                    if (letter === '') {
                        cell.style.cssText = `
                            width: var(--cell-size); height: var(--cell-size); 
                            background: #e0e0e0; border: clamp(1px, 0.1vw, 2px) solid #bbb;
                            border-radius: clamp(2px, 0.3vw, 4px); box-sizing: border-box;
                        `;
                    } else {
                        // í•´ë‹¹ ìœ„ì¹˜ì˜ ë‹¨ì–´ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const wordsAtCell = words.filter(word => {
                            if (!word.placed) return false;
                            for (let i = 0; i < word.word.length; i++) {
                                const wordRow = word.direction === 'horizontal' ? word.startRow : word.startRow + i;
                                const wordCol = word.direction === 'horizontal' ? word.startCol + i : word.startCol;
                                if (wordRow === row && wordCol === col) return true;
                            }
                            return false;
                        });
                        
                        // í•´ë‹¹ ì…€ì— ì†í•œ ì™„ì„±ëœ ë‹¨ì–´ë“¤ì˜ ì •ë‹µ ì—¬ë¶€ í™•ì¸
                        let cellBackgroundState = 'none'; // 'none', 'correct', 'incorrect'
                        
                        for (const word of wordsAtCell) {
                            // ë‹¨ì–´ê°€ ì™„ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
                            let isWordCompleted = true;
                            let isWordCorrect = true;
                            
                            for (let i = 0; i < word.word.length; i++) {
                                const wordRow = word.direction === 'horizontal' ? word.startRow : word.startRow + i;
                                const wordCol = word.direction === 'horizontal' ? word.startCol + i : word.startCol;
                                const inputChar = playerGrid[wordRow][wordCol];
                                
                                if (!inputChar || inputChar === '') {
                                    isWordCompleted = false;
                                    break;
                                }
                                
                                if (inputChar !== word.word[i]) {
                                    isWordCorrect = false;
                                }
                            }
                            
                            // ì™„ì„±ëœ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ ë°°ê²½ ìƒíƒœ ê²°ì •
                            if (isWordCompleted) {
                                if (isWordCorrect) {
                                    cellBackgroundState = 'correct';
                                } else if (cellBackgroundState !== 'correct') {
                                    cellBackgroundState = 'incorrect';
                                }
                            }
                        }
                        
                        let bgColor = 'white';
                        let borderColor = '#333';
                        
                        // ë°°ê²½ ìƒ‰ìƒì„ ì™„ì„±ëœ ë‹¨ì–´ì˜ ì •ë‹µ ì—¬ë¶€ì— ë”°ë¼ ê²°ì •
                        if (cellBackgroundState === 'correct') {
                            bgColor = '#c8e6c9';
                            borderColor = '#4caf50';
                        } else if (cellBackgroundState === 'incorrect') {
                            bgColor = '#ffcdd2';
                            borderColor = '#f44336';
                        }
                        
                        cell.className = 'solve-grid-cell';
                        cell.style.cssText = `
                            width: var(--cell-size); height: var(--cell-size); 
                            background: ${bgColor}; border: clamp(1px, 0.1vw, 2px) solid ${borderColor}; 
                            display: flex; align-items: center; justify-content: center; 
                            font-weight: bold; font-size: var(--cell-font-size); 
                            transition: all 0.3s; position: relative; box-sizing: border-box;
                            border-radius: clamp(2px, 0.3vw, 4px);
                        `;
                        
                        // í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë‹¨ì–´ í™•ì¸
                        const wordsStartingHere = words.filter(word => 
                            word.placed && word.startRow === row && word.startCol === col
                        );
                        
                        // ê°€ë¡œ ë‹¨ì–´ì™€ ì„¸ë¡œ ë‹¨ì–´ ë¶„ë¦¬
                        const horizontalWord = wordsStartingHere.find(word => word.direction === 'horizontal');
                        const verticalWord = wordsStartingHere.find(word => word.direction === 'vertical');
                        
                        // ê°€ë¡œ ë‹¨ì–´ ë²ˆí˜¸ í‘œì‹œ (íŒŒë€ìƒ‰)
                        if (horizontalWord) {
                            const horizontalLabel = document.createElement('div');
                            horizontalLabel.textContent = wordNumbers[horizontalWord.id]?.number || '?';
                            horizontalLabel.style.cssText = `
                                position: absolute; top: 0; left: 0; 
                                background: #2196F3; color: white; 
                                font-size: var(--cell-number-size); line-height: 1.1; 
                                padding: var(--label-padding); 
                                border-radius: 0 0 var(--label-border-radius) 0; 
                                font-weight: bold; z-index: 10;
                                min-width: var(--label-min-width); text-align: center;
                            `;
                            cell.appendChild(horizontalLabel);
                        }
                        
                        // ì„¸ë¡œ ë‹¨ì–´ ë²ˆí˜¸ í‘œì‹œ (ë¹¨ê°„ìƒ‰)
                        if (verticalWord) {
                            const verticalLabel = document.createElement('div');
                            verticalLabel.textContent = wordNumbers[verticalWord.id]?.number || '?';
                            verticalLabel.style.cssText = `
                                position: absolute; top: 0; ${horizontalWord ? 'left: var(--label-offset);' : 'left: 0;'} 
                                background: #f44336; color: white; 
                                font-size: var(--cell-number-size); line-height: 1.1; 
                                padding: var(--label-padding); 
                                border-radius: 0 0 var(--label-border-radius) 0; 
                                font-weight: bold; z-index: 10;
                                min-width: var(--label-min-width); text-align: center;
                            `;
                            cell.appendChild(verticalLabel);
                        }
                        
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = playerGrid[row][col] || '';
                        input.style.cssText = 'width: 100%; height: 100%; border: none; outline: none; background: transparent; text-align: center; font-weight: bold; font-size: var(--cell-font-size); ime-mode: active; caret-color: transparent; cursor: text; box-sizing: border-box;';
                        
                        // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ - ì„¸ë ¨ëœ íš¨ê³¼ ì ìš©
                        let blurTimeout;
                        let keepFocused = false;
                        
                        const maintainFocus = () => {
                            if (blurTimeout) {
                                clearTimeout(blurTimeout);
                                blurTimeout = null;
                            }
                            if (keepFocused) {
                                input.focus();
                                cell.classList.add('focused');
                            }
                        };
                        
                        input.addEventListener('focus', () => {
                            keepFocused = true;
                            maintainFocus();
                        });
                        
                        input.addEventListener('blur', () => {
                            // ë” ê¸´ ì§€ì—°ìœ¼ë¡œ ì—°ì† í‚¤ë³´ë“œ ì‘ì—… ì§€ì› (150ms â†’ 800ms)
                            blurTimeout = setTimeout(() => {
                                keepFocused = false;
                                cell.classList.remove('focused');
                                blurTimeout = null;
                            }, 800);
                        });
                        
                        // ëª¨ë“  í‚¤ë³´ë“œ ì´ë²¤íŠ¸ì—ì„œ í¬ì»¤ìŠ¤ ìœ ì§€
                        input.addEventListener('keydown', (e) => {
                            maintainFocus();
                            
                            // í‚¤ë³´ë“œ ì‘ì—… í›„ í¬ì»¤ìŠ¤ ë³µì› (ë” ì•ˆì •ì ìœ¼ë¡œ)
                            setTimeout(() => {
                                if (keepFocused) {
                                    maintainFocus();
                                }
                            }, 50);
                        });
                        
                        input.addEventListener('keyup', () => {
                            maintainFocus();
                        });
                        
                        // IME(í•œê¸€ ì…ë ¥) ì´ë²¤íŠ¸ì—ì„œë„ í¬ì»¤ìŠ¤ ìœ ì§€
                        input.addEventListener('compositionstart', () => {
                            maintainFocus();
                        });
                        
                        input.addEventListener('compositionupdate', () => {
                            maintainFocus();
                        });
                        
                        input.addEventListener('compositionend', () => {
                            maintainFocus();
                            // í•œê¸€ ì¡°í•© ì™„ë£Œ í›„ í¬ì»¤ìŠ¤ í™•ì‹¤íˆ ìœ ì§€
                            setTimeout(() => {
                                if (keepFocused) {
                                    maintainFocus();
                                }
                            }, 100);
                        });
                        
                        // ì…€ í´ë¦­ ì‹œ ëª…í™•í•œ í¬ì»¤ìŠ¤ ì„¤ì •
                        cell.addEventListener('click', () => {
                            keepFocused = true;
                            maintainFocus();
                            input.select(); // í…ìŠ¤íŠ¸ ì„ íƒìœ¼ë¡œ í™•ì‹¤í•œ í¬ì»¤ìŠ¤
                        });
                        
                        // í•œê¸€ ì…ë ¥ ì§€ì› ê°œì„ 
                        let isComposing = false;
                        
                        input.addEventListener('compositionstart', () => {
                            isComposing = true;
                            // í¬ì»¤ìŠ¤ ìœ ì§€
                            setTimeout(() => {
                                if (activeInputField === `${row}-${col}`) {
                                    input.focus();
                                }
                            }, 1);
                        });
                        
                        input.addEventListener('compositionend', (e) => {
                            isComposing = false;
                            let value = e.target.value;
                            if (value.length > 0) {
                                value = processInputValue(value);
                            }
                            e.target.value = value;
                            handleInputChange(row, col, value);
                            
                            // í¬ì»¤ìŠ¤ ìœ ì§€
                            setTimeout(() => {
                                if (activeInputField === `${row}-${col}`) {
                                    e.target.focus();
                                }
                            }, 1);
                        });
                        
                        input.addEventListener('input', (e) => {
                            // í•œê¸€ ì¡°í•© ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì²˜ë¦¬
                            if (!isComposing) {
                                let value = e.target.value;
                                if (value.length > 0) {
                                    value = processInputValue(value);
                                }
                                e.target.value = value;
                                handleInputChange(row, col, value);
                                
                                // í¬ì»¤ìŠ¤ ìœ ì§€
                                setTimeout(() => {
                                    if (activeInputField === `${row}-${col}`) {
                                        e.target.focus();
                                    }
                                }, 1);
                            }
                        });
                        
                        input.addEventListener('keydown', (e) => {
                            // ë°±ìŠ¤í˜ì´ìŠ¤/Deleteë¡œ ì‚­ì œ
                            if (e.key === 'Backspace' || e.key === 'Delete') {
                                e.target.value = '';
                                handleInputChange(row, col, '');
                            }
                            
                            // í¬ì»¤ìŠ¤ ìœ ì§€
                            setTimeout(() => {
                                if (activeInputField === `${row}-${col}`) {
                                    e.target.focus();
                                }
                            }, 1);
                        });
                        
                        // ì…ë ¥ í•„ë“œ í´ë¦­ ì‹œ í¬ì»¤ìŠ¤ ìœ ì§€
                        input.addEventListener('click', (e) => {
                            e.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
                            e.target.focus();
                            e.target.select(); // ê¸°ì¡´ í…ìŠ¤íŠ¸ ì„ íƒ
                            activeInputField = `${row}-${col}`;
                        });
                        
                        // ì…€ì— data-cell ì†ì„± ì¶”ê°€
                        cell.setAttribute('data-cell', `${row}-${col}`);
                        
                        // ì…€ í´ë¦­ ì‹œ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                        cell.addEventListener('click', (event) => {
                            if (mode === 'solve') {
                                event.preventDefault();
                                event.stopPropagation();
                                
                                // ì´ì „ í™œì„± ì…ë ¥ í•„ë“œì˜ í¬ì»¤ìŠ¤ í•´ì œ
                                if (activeInputField && activeInputField !== `${row}-${col}`) {
                                    const prevElement = document.querySelector(`[data-cell="${activeInputField}"] input`);
                                    if (prevElement) {
                                        prevElement.blur();
                                    }
                                }
                                
                                setTimeout(() => {
                                    input.focus();
                                    input.select();
                                    activeInputField = `${row}-${col}`;
                                    
                                    // ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ê°•í™”
                                    input.style.caretColor = '#2563eb';
                                    input.style.outline = 'none';
                                    input.style.border = 'none';
                                }, 10);
                            }
                        });
                        
                        cell.appendChild(input);
                    }
                    
                    gridElement.appendChild(cell);
                }
            }
        }

        function updateSolveGridDisplay() {
            if (mode === 'solve') {
                showSolveMode();
            }
        }

        function resetPlayerGrid() {
            playerGrid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
            completedWords = new Set();
            missionCompleted = false;
            updateSolveGridDisplay();
        }
        
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.id === 'wordInput') {
                addWord();
            }
        });
        
        // ğŸŒ Supabase ê¸°ë°˜ URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬ (í´ë°± ì§€ì›)
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const codeFromUrl = urlParams.get('code');
            
            if (codeFromUrl) {
                // ë¡œë”© í‘œì‹œ
                const loadingDiv = document.createElement('div');
                loadingDiv.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(255,255,255,0.95); z-index: 9999; 
                    display: flex; align-items: center; justify-content: center;
                `;
                loadingDiv.innerHTML = `
                    <div style="text-align: center;">
                        <div style="color: #2196F3; font-size: 24px; font-weight: bold; margin-bottom: 15px;">
                            ğŸ” í€´ì¦ˆ ë¡œë”© ì¤‘...
                        </div>
                        <div style="color: #666; font-size: 16px;">
                            í€´ì¦ˆ ì½”ë“œ: ${codeFromUrl}
                        </div>
                    </div>
                `;
                document.body.appendChild(loadingDiv);
                
                // Supabaseì—ì„œ í€´ì¦ˆ ë¡œë“œ
                (async () => {
                    try {
                        // Supabaseì—ì„œ í€´ì¦ˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                        const quizData = await loadQuizFromSupabase(codeFromUrl.toUpperCase());
                        
                        // ë¡œë”©ì°½ ì œê±°
                        if (loadingDiv.parentNode) {
                            document.body.removeChild(loadingDiv);
                        }
                        
                        // ğŸ”’ ê³µìœ ë°›ì€ í€´ì¦ˆ ìƒíƒœë¡œ ì„¤ì • (ë³´ì•ˆ ê²©ë¦¬)
                        isSharedQuizMode = true;
                        sharedQuizData = { ...quizData };
                        
                        // í€´ì¦ˆ ë°ì´í„° ë¡œë“œ (ì½ê¸° ì „ìš©)
                        words = quizData.words || [];
                        grid = quizData.grid || Array(10).fill(null).map(() => Array(10).fill(''));
                        gridSize = quizData.gridSize || { rows: 10, cols: 10 };
                        
                        // ğŸš¨ ì œì‘ëª¨ë“œ ë°ì´í„° ê²©ë¦¬
                        const originalTitle = document.getElementById('quizTitle');
                        if (originalTitle) {
                            originalTitle.value = ''; // ì œì‘ëª¨ë“œìš© ì œëª©ì€ ë¹„ì›Œë‘ 
                        }
                        
                        // í’€ì´ ëª¨ë“œë¡œ ì „í™˜
                        mode = 'solve';
                        playerGrid = Array(gridSize.rows).fill(null).map(() => Array(gridSize.cols).fill(''));
                        completedWords = new Set();
                        missionCompleted = false;
                        
                        // ë‹¨ì–´ ë²ˆí˜¸ ìƒì„±
                        wordNumbers = generateWordNumbers(words);
                        
                        // í’€ì´ ëª¨ë“œ í™”ë©´ í‘œì‹œ
                        showSolveMode();
                        
                        // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                        setTimeout(() => {
                            alert(`ğŸ® "${quizData.title || 'ë‚±ë§í€´ì¦ˆ'}" ë¡œë“œ ì™„ë£Œ!\nì¦ê±°ìš´ í€´ì¦ˆ ì‹œê°„ ë˜ì„¸ìš”! ğŸ§©`);
                        }, 500);
                        
                    } catch (error) {
                        // ë¡œë”©ì°½ ì œê±°
                        if (loadingDiv.parentNode) {
                            document.body.removeChild(loadingDiv);
                        }
                        
                        console.error('âŒ í€´ì¦ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
                        
                        // ì‚¬ìš©ì ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
                        let errorMessage = 'âŒ í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n';
                        
                        if (error.message && error.message.includes('Failed to fetch')) {
                            errorMessage += 'ğŸŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else if (error.message && error.message.includes('í€´ì¦ˆ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')) {
                            errorMessage += 'ğŸ“ í€´ì¦ˆ ì½”ë“œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        } else if (error.message && error.message.includes('í€´ì¦ˆ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤')) {
                            errorMessage += 'ğŸ“„ í€´ì¦ˆ ë°ì´í„°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.\ní€´ì¦ˆ ì œì‘ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                        } else if (error.message && error.message.includes('ì´ˆê¸°í™”')) {
                            errorMessage += 'ğŸ”§ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else {
                            errorMessage += 'ğŸ”„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        }
                        
                        alert(errorMessage);
                    }
                })();
                
            } else {
                // ì¼ë°˜ ì ‘ì† ì‹œ ì œì‘ëª¨ë“œë¡œ ì‹œì‘
                isSharedQuizMode = false;
                sharedQuizData = null;
            }
        });
        
        console.log('âœ… ê°€ë¡œì„¸ë¡œ ë‚±ë§í€´ì¦ˆ ë†€ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');

        async function saveQuiz() {
            const placedWords = words.filter(w => w.placed);
            
            if (placedWords.length === 0) {
                alert('ë‹¨ì–´ë¥¼ ë¨¼ì € ë°°ì¹˜í•˜ì„¸ìš”!');
                return null;
            }
            
            const quizTitle = document.getElementById('quizTitle').value;
            if (!quizTitle.trim()) {
                alert('í€´ì¦ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return null;
            }
            
            // ë” ê³ ìœ í•œ í€´ì¦ˆ ì½”ë“œ ìƒì„± (ì‹œê°„ + ëœë¤)
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substr(2, 4).toUpperCase();
            const code = (timestamp + random).substr(-8);
            
            const quizData = {
                title: quizTitle,
                words: placedWords,
                grid: grid,
                gridSize: gridSize,
                code: code,
                createdAt: new Date().toISOString(),
                version: '3.1' // ë‹¨ìˆœí™” ë²„ì „
            };
            
            // Supabaseì— ì €ì¥
            try {
                await saveQuizToSupabase(quizData);
                
                return {
                    code: code,
                    quizData: quizData
                };
            } catch (error) {
                // Supabase ì €ì¥ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ ìƒìœ„ì—ì„œ ì²˜ë¦¬
                throw error;
            }
        }

        function shareQuiz() {
            if (words.length === 0) {
                alert('ë‹¨ì–´ë¥¼ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”!');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            const loadingAlert = document.createElement('div');
            loadingAlert.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 2000; text-align: center; min-width: 200px;
            `;
            loadingAlert.innerHTML = `
                <div style="color: #2196F3; font-weight: bold; margin-bottom: 10px;">ğŸ’¾ í€´ì¦ˆ ì €ì¥ ì¤‘...</div>
                <div style="color: #666; font-size: 14px;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
            `;
            document.body.appendChild(loadingAlert);
            
            // ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ê³µìœ ì°½ í‘œì‹œ
            (async () => {
                try {
                    // í€´ì¦ˆ ì €ì¥ ë° ì½”ë“œ ìƒì„±
                    const result = await saveQuiz();
                    
                    // ë¡œë”©ì°½ ì œê±°
                    if (loadingAlert && loadingAlert.parentNode) {
                        document.body.removeChild(loadingAlert);
                    }
                    
                    // resultê°€ nullì´ë©´ ì €ì¥ì´ ì·¨ì†Œëœ ê²ƒì´ë¯€ë¡œ ì¡°ìš©íˆ ì¢…ë£Œ
                    if (!result || !result.code) {
                        return;
                    }
                    
                    // ê³µìœ ì°½ í‘œì‹œ
                    showShareModal(result.code, result.quizData);
                    
                } catch (error) {
                    // ë¡œë”©ì°½ ì œê±°
                    if (loadingAlert && loadingAlert.parentNode) {
                        document.body.removeChild(loadingAlert);
                    }
                    
                    console.error('âŒ ê³µìœ  ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    
                    // ì‚¬ìš©ì ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
                    let errorMessage = 'âŒ í€´ì¦ˆ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\n';
                    
                    if (error.message && error.message.includes('Failed to fetch')) {
                        errorMessage += 'ğŸŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message && error.message.includes('ì´ˆê¸°í™”')) {
                        errorMessage += 'ğŸ”§ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (error.message && error.message.includes('duplicate')) {
                        errorMessage += 'ğŸ”„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else {
                        errorMessage += 'ğŸ”„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                    
                    alert(errorMessage);
                }
            })();
        }
        
        // ê³µìœ  ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showShareModal(code, quizData) {
            // ğŸŒ Supabase ê¸°ë°˜ ê³µìœ  URL ìƒì„±
            const shareUrl = generateShareUrl(code);
            
            // ê³µìœ  ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); z-index: 1000; display: flex;
                justify-content: center; align-items: flex-start; padding: 20px; box-sizing: border-box;
                overflow-y: auto; padding-top: 50px; padding-bottom: 50px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; max-width: 500px; width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.3); text-align: center; position: relative; max-height: 80vh; overflow-y: auto;">
                    <button onclick="this.closest('div').parentElement.remove()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999; z-index: 10; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">Ã—</button>
                    
                    <h2 style="text-align: center; color: #2196F3; margin-bottom: 20px;">ğŸ® í€´ì¦ˆ ê³µìœ í•˜ê¸°</h2>
                    <p style="color: #666; margin-bottom: 25px;">ë‚´ê°€ ë§Œë“  í€´ì¦ˆë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                    
                    <!-- QR ì½”ë“œ ì„¹ì…˜ -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #333;">ğŸ“± QR ì½”ë“œ ê³µìœ </h3>
                        <div style="display: flex; justify-content: center; margin: 15px 0;">
                            <canvas id="qrcode-canvas" style="border: 2px solid #e0e0e0; border-radius: 10px;"></canvas>
                        </div>
                        <p style="color: #666; font-size: 14px;">ğŸ“± QR ì½”ë“œ ìŠ¤ìº”ìœ¼ë¡œ ì¦‰ì‹œ ì ‘ì†!</p>
                    </div>
                    
                    <!-- URL ë§í¬ ì„¹ì…˜ -->
                    <div style="background: #fff3cd; border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                        <h3 style="color: #856404; margin-bottom: 15px; text-align: center;">ğŸŒ URL ë§í¬ ê³µìœ </h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="share-url-input" value="${shareUrl}" readonly 
                                style="flex: 1; padding: 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 12px; background: white; word-break: break-all;">
                            <button onclick="copyShareUrl()" style="background: #f39c12; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap;">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                        </div>
                        <p style="color: #856404; font-size: 12px; margin-top: 10px;">â˜ï¸ í´ë¼ìš°ë“œì— ì €ì¥ë˜ì–´ ëˆ„êµ¬ë“  ì ‘ì† ê°€ëŠ¥!</p>
                    </div>
                    
                    <!-- í€´ì¦ˆ ì½”ë“œ ì„¹ì…˜ -->
                    <div style="background: #d1ecf1; border-radius: 15px; padding: 20px;">
                        <h3 style="color: #0c5460; margin-bottom: 15px; text-align: center;">ğŸ¯ í€´ì¦ˆ ì½”ë“œ ê³µìœ </h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="quiz-code-input" value="${code}" readonly 
                                style="flex: 1; padding: 12px; border: 2px solid #bee5eb; border-radius: 8px; font-size: 16px; font-weight: bold; text-align: center; background: white; font-family: monospace;">
                            <button onclick="copyQuizCode()" style="background: #17a2b8; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; white-space: nowrap;">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                        </div>
                        <p style="color: #0c5460; font-size: 12px; margin-top: 10px;">ğŸ’¡ í’€ì´ ëª¨ë“œ â†’ ì½”ë“œ ì…ë ¥ìœ¼ë¡œ í€´ì¦ˆ í”Œë ˆì´ ê°€ëŠ¥</p>
                    </div>
                    
                    <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                        <p style="color: #999; font-size: 12px;">ğŸ¯ <strong>í€´ì¦ˆ ì œëª©:</strong> ${document.getElementById('quizTitle').value || 'ë¬´ì œ'}</p>
                        <p style="color: #999; font-size: 12px;">ğŸ“ <strong>ë‹¨ì–´ ê°œìˆ˜:</strong> ${words.length}ê°œ</p>
                        <p style="color: #2196F3; font-size: 12px; margin-top: 10px; text-align: center;"><strong>â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥:</strong> í€´ì¦ˆ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ ëˆ„êµ¬ë“  ì ‘ì† ê°€ëŠ¥!</p>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ì„ bodyì— ì¶”ê°€
            document.body.appendChild(modal);
            
            // URL ë³µì‚¬ í•¨ìˆ˜ë“¤ì„ ì „ì—­ìœ¼ë¡œ ì„¤ì •
            window.copyShareUrl = function() {
                const input = document.getElementById('share-url-input');
                input.select();
                input.setSelectionRange(0, 99999);
                
                try {
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        alert('âœ… URL ë³µì‚¬ë¨! ğŸ”—');
                    });
                } catch (err) {
                    document.execCommand('copy');
                    alert('âœ… URL ë³µì‚¬ë¨! ğŸ”—');
                }
            };
            
            window.copyQuizCode = function() {
                const input = document.getElementById('quiz-code-input');
                input.select();
                input.setSelectionRange(0, 99999);
                
                try {
                    navigator.clipboard.writeText(code).then(() => {
                        alert('âœ… ì½”ë“œ ë³µì‚¬ë¨! ğŸ¯');
                    });
                } catch (err) {
                    document.execCommand('copy');
                    alert('âœ… ì½”ë“œ ë³µì‚¬ë¨! ğŸ¯');
                }
            };
            
            // QRì½”ë“œ ìƒì„± (ê°œì„ ëœ ë²„ì „)
            function tryGenerateQR() {
                console.log('ğŸ”„ QRì½”ë“œ ìƒì„± ì‹œì‘...');
                console.log('ğŸ¯ ê³µìœ  URL:', shareUrl);
                
                const canvas = document.getElementById('qrcode-canvas');
                
                if (!canvas) {
                    console.error('âŒ QR ì½”ë“œ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // Google Charts APIë¥¼ ì‚¬ìš©í•œ QR ì½”ë“œ ìƒì„±
                window.generateQRCode(shareUrl, canvas, {
                    width: 160,
                    margin: 2,
                    color: {
                        dark: '#1976D2',
                        light: '#FFFFFF'
                    },
                    onSuccess: function() {
                        console.log('âœ… QR ì½”ë“œ ìƒì„± ì„±ê³µ!');
                        console.log('ğŸ“± QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ë©´ ìë™ìœ¼ë¡œ í€´ì¦ˆê°€ ë¡œë“œë©ë‹ˆë‹¤');
                    },
                    onError: function(error) {
                        console.error('âŒ QRì½”ë“œ ìƒì„± ì˜¤ë¥˜:', error);
                        // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ í…ìŠ¤íŠ¸ í‘œì‹œ
                        canvas.style.display = 'none';
                        canvas.parentElement.innerHTML = `
                            <div style="text-align: center; color: #666; font-size: 12px; padding: 20px;">
                                <p>âš ï¸ QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨</p>
                                <p style="margin-top: 10px;">URL ë§í¬ë‚˜ í€´ì¦ˆ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”</p>
                                <div style="margin-top: 15px; font-size: 11px; color: #999;">
                                    <p>ğŸŒ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”</p>
                                </div>
                            </div>
                        `;
                    }
                });
            }
            
            // QR ì½”ë“œ ìƒì„± ì‹œì‘
            setTimeout(() => tryGenerateQR(), 100);
            
            // ëª¨ë‹¬ í´ë¦­ ì‹œ ë‹«ê¸° (ëª¨ë‹¬ ë°°ê²½ í´ë¦­)
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ğŸŒ Supabase ê¸°ë°˜ í¬ë¡œìŠ¤ ë””ë°”ì´ìŠ¤ í€´ì¦ˆ ê³µìœ  ì‹œìŠ¤í…œ
        
                // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        const SUPABASE_URL = 'https://ecgrscpspkruypnbtlsu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjZ3JzY3BzcGtydXlwbmJ0bHN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MjMwNTgsImV4cCI6MjA2ODQ5OTA1OH0.2vQSeaySO7rMvpRBNFH7w3IeIwVgRwiKqfk58kP2cA8';
        
        // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± (ì•ˆì „í•œ ì´ˆê¸°í™”)
        let supabase;
        
        // í˜ì´ì§€ ë¡œë“œ í›„ Supabase ì´ˆê¸°í™”
        function initializeSupabase() {
            try {
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                    auth: {
                        persistSession: false,
                        autoRefreshToken: false
                    }
                });
                
                console.log('âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
                return true;
            } catch (error) {
                console.error('âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                return false;
            }
        }


        
        // Supabaseì— í€´ì¦ˆ ì €ì¥
        async function saveQuizToSupabase(quizData) {
            console.log('ğŸ’¾ Supabase ì €ì¥ ì‹œì‘:', quizData.code);
            
            // Supabase ì´ˆê¸°í™” í™•ì¸
            if (!supabase) {
                const initialized = initializeSupabase();
                if (!initialized) {
                    throw new Error('Supabase ì´ˆê¸°í™” ì‹¤íŒ¨');
                }
            }
            
            try {
                // ë¨¼ì € ê°™ì€ ì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                const { data: existing } = await supabase
                    .from('quizzes')
                    .select('quiz_code')
                    .eq('quiz_code', quizData.code)
                    .single();
                
                if (existing) {
                    // ê¸°ì¡´ í€´ì¦ˆ ì—…ë°ì´íŠ¸
                    const { data, error } = await supabase
                        .from('quizzes')
                        .update({
                            title: quizData.title,
                            quiz_data: quizData,
                            created_at: new Date().toISOString()
                        })
                        .eq('quiz_code', quizData.code);
                    
                    if (error) throw error;
                    console.log('âœ… Supabase ì—…ë°ì´íŠ¸ ì„±ê³µ:', quizData.code);
                } else {
                    // ìƒˆ í€´ì¦ˆ ìƒì„±
                    const { data, error } = await supabase
                        .from('quizzes')
                        .insert([{
                            quiz_code: quizData.code,
                            title: quizData.title,
                            quiz_data: quizData,
                            created_at: new Date().toISOString()
                        }]);
                    
                    if (error) throw error;
                    console.log('âœ… Supabase ì €ì¥ ì„±ê³µ:', quizData.code);
                }
                
                return { success: true };
                
            } catch (error) {
                console.error('âŒ Supabase ì €ì¥ ì‹¤íŒ¨:', error);
                console.error('ìƒì„¸ ì˜¤ë¥˜:', {
                    message: error.message,
                    details: error.details,
                    hint: error.hint,
                    code: error.code
                });
                throw error;
            }
        }
        
        // Supabaseì—ì„œ í€´ì¦ˆ ë¡œë“œ
        async function loadQuizFromSupabase(code) {
            console.log('ğŸ” Supabase ë¡œë“œ ì‹œì‘:', code);
            
            // Supabase ì´ˆê¸°í™” í™•ì¸
            if (!supabase) {
                const initialized = initializeSupabase();
                if (!initialized) {
                    throw new Error('Supabase ì´ˆê¸°í™” ì‹¤íŒ¨');
                }
            }
            
            try {
                const { data, error } = await supabase
                    .from('quizzes')
                    .select('quiz_data')
                    .eq('quiz_code', code)
                    .single();
                
                if (error) {
                    console.error('âŒ Supabase ë¡œë“œ ì‹¤íŒ¨:', error);
                    console.error('ìƒì„¸ ì˜¤ë¥˜:', {
                        message: error.message,
                        details: error.details,
                        hint: error.hint,
                        code: error.code
                    });
                    
                    if (error.code === 'PGRST116') {
                        throw new Error('í€´ì¦ˆ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                    throw error;
                }
                
                if (!data || !data.quiz_data) {
                    throw new Error('í€´ì¦ˆ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
                }
                
                console.log('âœ… Supabase ë¡œë“œ ì„±ê³µ:', data.quiz_data.title);
                return data.quiz_data;
                
            } catch (error) {
                if (error.message.includes('í€´ì¦ˆ')) {
                    throw error; // ì´ë¯¸ ì²˜ë¦¬ëœ ì˜¤ë¥˜ëŠ” ê·¸ëŒ€ë¡œ ì „ë‹¬
                }
                console.error('âŒ ì˜ˆìƒì¹˜ ëª»í•œ ë¡œë“œ ì˜¤ë¥˜:', error);
                throw new Error('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }
        
        // ê°„ë‹¨í•œ ê³µìœ  URL ìƒì„±
        function generateShareUrl(code) {
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?code=${code}`;
            
            return shareUrl;
        }
        
        // ğŸ”§ ë””ë²„ê¹…ìš©: Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ (ê°œë°œì ë„êµ¬ì—ì„œ ì‹¤í–‰)
        window.testSupabase = async function() {
            try {
                console.log('ğŸ”§ Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                console.log('ğŸ“‹ URL:', SUPABASE_URL);
                
                // Supabase ì´ˆê¸°í™” í™•ì¸
                if (!supabase) {
                    console.log('ğŸ”„ Supabase ì´ˆê¸°í™” ì¤‘...');
                    const initialized = initializeSupabase();
                    if (!initialized) {
                        console.error('âŒ Supabase ì´ˆê¸°í™” ì‹¤íŒ¨');
                        return false;
                    }
                }
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await supabase
                    .from('quizzes')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    console.error('âŒ ì—°ê²° ì‹¤íŒ¨:', error);
                    console.error('ìƒì„¸ ì •ë³´:', {
                        message: error.message,
                        details: error.details,
                        hint: error.hint,
                        code: error.code
                    });
                    return false;
                }
                
                console.log('âœ… Supabase ì—°ê²° ì„±ê³µ!');
                console.log('ğŸ“Š ì¡°íšŒëœ ë°ì´í„°:', data);
                return true;
                
            } catch (error) {
                console.error('âŒ ì—°ê²° ì˜¤ë¥˜:', error);
                return false;
            }
        };
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ Supabase ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, Supabase ì´ˆê¸°í™” ì¤‘...');
            initializeSupabase();
        });
        

        

    </script>
</body>
</html> 